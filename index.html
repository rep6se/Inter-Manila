<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>INTER MANILA</title>

<meta name="application-name" content="INTER MANILA">
<meta name="apple-mobile-web-app-title" content="INTER MANILA">
<meta name="description" content="Statistik dan Rekor Klub Real-Time.">
<meta name="theme-color" content="#020617">

<meta property="og:title" content="INTER MANILA">
<meta property="og:site_name" content="INTER MANILA">
<meta property="og:url" content="https://rep6se.github.io/Inter-Manila">
<meta property="og:type" content="website">
<meta property="og:image" content="https://rep6se.github.io/Inter-Manila/inter-milan-old.png">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

<style>
    :root {
        --primary: #3b82f6; 
        --primary-dark: #1d4ed8;
        --bg-dark: #020617;
        --bg-card: rgba(30, 41, 59, 0.6);
        --glass-border: rgba(255, 255, 255, 0.08);
        --accent: #60a5fa; 
        --success: #10b981;
        --danger: #ef4444; 
        --warning: #f59e0b; 
        --gold: #fbbf24; 
        --silver: #94a3b8; 
        --bronze: #d97706;
        --text-main: #f8fafc;
        --text-muted: #94a3b8;
        --ai-gradient: linear-gradient(135deg, #6366f1, #a855f7);
    }

    * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; }

    body { 
        margin: 0; 
        font-family: 'Inter', sans-serif; 
        background: #020617;
        background-image: 
            radial-gradient(circle at 15% 50%, rgba(37, 99, 235, 0.15), transparent 25%), 
            radial-gradient(circle at 85% 30%, rgba(16, 185, 129, 0.05), transparent 25%);
        background-attachment: fixed;
        color: var(--text-main); 
        min-height: 100vh; 
        padding-bottom: 110px;
        user-select: none; -webkit-user-select: none; overflow-x: hidden;
    }

    /* === TYPOGRAPHY UTILS === */
    .font-num { font-family: 'Oswald', sans-serif; letter-spacing: 0.5px; }
    h1, h2, h3 { font-family: 'Oswald', sans-serif; text-transform: uppercase; }

    /* === WELCOME OVERLAY === */
    #welcomeOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle at center, #1e293b, #020617);
        z-index: 99999;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        transition: opacity 0.8s ease, visibility 0.8s;
    }
    #welcomeOverlay.fade-out { opacity: 0; visibility: hidden; }
    
    .intro-logo-container {
        position: relative; width: 120px; height: 120px;
        display: flex; align-items: center; justify-content: center;
        margin-bottom: 30px;
    }
    .intro-circle {
        position: absolute; width: 100%; height: 100%; border-radius: 50%;
        border: 2px solid transparent; border-top-color: var(--primary); border-bottom-color: var(--accent);
        animation: spinIntro 2s linear infinite;
    }
    .welcome-logo { width: 80px; filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.6)); animation: pulseLogo 2s infinite; }
    
    .welcome-text-box { text-align: center; }
    .welcome-title { 
        font-family: 'Oswald', sans-serif; font-size: 32px; font-weight: 700; letter-spacing: 4px; color: #fff;
        opacity: 0; animation: fadeUp 0.8s ease forwards 0.3s;
    }
    .welcome-sub {
        font-size: 12px; color: var(--accent); letter-spacing: 2px; text-transform: uppercase; margin-top: 5px;
        opacity: 0; animation: fadeUp 0.8s ease forwards 0.6s;
    }
    .loading-bar-container {
        width: 140px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 40px; overflow: hidden;
        opacity: 0; animation: fadeIn 0.5s ease forwards 1s;
    }
    .loading-bar {
        height: 100%; width: 0%; background: var(--primary);
        animation: loadProgress 2.5s ease-in-out forwards 1s;
    }

    @keyframes spinIntro { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes pulseLogo { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes loadProgress { 0% { width: 0%; } 100% { width: 100%; } }

    /* === HEADER === */
    header { 
        text-align: center; padding: 25px 0 15px; 
        background: var(--bg-dark); 
        border-bottom: 1px solid var(--glass-border);
        position: sticky; top: 0; z-index: 100;
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    .logo-main { width: 55px; filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.4)); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .logo-main:active { transform: scale(0.85) rotate(-5deg); }
    header h1 { font-size: 22px; margin: 10px 0 0; letter-spacing: 2px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

    .container { width: 100%; margin: 0 auto; padding: 0 20px; max-width: 600px; }

    /* === CUSTOM DROPDOWN === */
    .custom-select-btn {
        background: rgba(255,255,255,0.05) !important;
        border: 1px solid var(--glass-border) !important;
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 8px 16px;
        display: flex; align-items: center; justify-content: space-between; gap: 10px;
        color: #fff; font-size: 13px; font-weight: 600; font-family: 'Inter', sans-serif;
        min-width: 140px; cursor: pointer; transition: 0.2s;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .custom-select-btn:active { transform: scale(0.96); }
    
    .dropdown-menu {
        background: #1e293b; border: 1px solid var(--glass-border);
        border-radius: 16px; width: 180px; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        padding: 6px; position: absolute; top: calc(100% + 8px); right: 0; z-index: 2000;
        display: none; animation: slideDown 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        transform-origin: top right;
    }
    @keyframes slideDown { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    
    .d-item {
        padding: 10px 14px; border-radius: 10px; font-size: 13px; font-weight: 500; color: var(--text-muted);
        transition: 0.2s; display: flex; justify-content: space-between; align-items: center; cursor: pointer;
    }
    .d-item:hover, .d-item.active { background: var(--primary); color: #fff; }

    /* === PAGE TRANSITIONS === */
    .page-section { display: none; opacity: 0; transform: translateY(10px); transition: 0.4s ease; }
    .page-section.active { display: block; opacity: 1; transform: translateY(0); }

    /* === AI SUMMARY CARD === */
    .ai-card {
        background: rgba(30, 41, 59, 0.4); 
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 20px; padding: 16px; margin-bottom: 20px;
        position: relative; overflow: hidden;
    }
    .ai-card::before {
        content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
        background: var(--ai-gradient);
    }
    .ai-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .ai-badge { 
        background: var(--ai-gradient); color: #fff; font-size: 9px; font-weight: 700; 
        padding: 3px 8px; border-radius: 10px; display: flex; align-items: center; gap: 4px;
        box-shadow: 0 0 10px rgba(99, 102, 241, 0.4);
    }
    .ai-content { font-size: 12px; color: #e2e8f0; line-height: 1.5; font-style: italic; }
    .typing-cursor::after { content: '|'; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0; } }

    /* === STATS CARDS === */
    .dashboard-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; margin-top: 20px; }
    .welcome-box h2 { font-size: 26px; margin: 0; color: #fff; }
    .welcome-box p { font-size: 12px; color: var(--accent); font-weight: 600; margin-top: 2px; }

    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
    .stat-card { 
        background: var(--bg-card); border-radius: 24px; padding: 20px; 
        border: 1px solid var(--glass-border); backdrop-filter: blur(12px);
        position: relative; overflow: hidden;
    }
    .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: linear-gradient(90deg, var(--primary), transparent); opacity: 0.5; }
    
    .stat-card h3 { font-size: 11px; color: var(--text-muted); margin: 0; letter-spacing: 1px; font-weight: 600; }
    .stat-card .val { font-family: 'Oswald', sans-serif; font-size: 32px; font-weight: 700; color: #fff; display: block; margin: 5px 0 0; }
    .stat-sub { font-size: 10px; color: var(--accent); font-weight: 600; opacity: 0.8; }

    /* Win Rate Donut Chart */
    .full-card { grid-column: span 2; display: flex; align-items: center; justify-content: space-between; padding-right: 30px; }
    .winrate-content { flex: 1; }
    .chart-container { position: relative; width: 80px; height: 80px; }
    .donut-chart {
        width: 100%; height: 100%; border-radius: 50%;
        background: conic-gradient(var(--success) calc(var(--percent) * 1%), rgba(255,255,255,0.05) 0);
        position: relative; display: flex; justify-content: center; align-items: center;
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
    }
    .donut-chart::after {
        content: ''; position: absolute; width: 65px; height: 65px; 
        background: #101624; border-radius: 50%;
    }
    .chart-text {
        position: absolute; z-index: 2; font-family: 'Oswald', sans-serif; 
        font-size: 20px; font-weight: 700; color: #fff;
    }

    /* Form Dots */
    .form-dots { display: flex; gap: 6px; margin-top: 12px; }
    .dot { width: 20px; height: 6px; border-radius: 4px; background: rgba(255,255,255,0.1); }
    .dot-W { background: var(--success); box-shadow: 0 0 8px rgba(16,185,129,0.4); }
    .dot-L { background: var(--danger); }
    .dot-D { background: var(--text-muted); }

    /* Recent Activity */
    .recent-box { background: var(--bg-card); border-radius: 24px; padding: 20px; border: 1px solid var(--glass-border); }
    .activity-item { 
        padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); 
        display: flex; justify-content: space-between; align-items: center;
    }
    .activity-item:last-child { border-bottom: none; }
    .team-info b { font-size: 14px; display: block; font-weight: 600; }
    .team-info small { color: var(--text-muted); font-size: 10px; text-transform: uppercase; font-weight: 500; }
    .score-pill { 
        font-family: 'Oswald', sans-serif; font-size: 16px; font-weight: 600; 
        background: rgba(0,0,0,0.3); padding: 4px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05);
    }

    /* === MATCHES === */
    .match-card { 
        background: var(--bg-card); border-radius: 20px; padding: 0; 
        margin-bottom: 16px; border: 1px solid var(--glass-border); overflow: hidden;
        animation: cardEntry 0.5s ease backwards;
    }
    @keyframes cardEntry { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .match-header { background: rgba(255,255,255,0.03); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass-border); }
    .league-tag { font-size: 10px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 0.5px; }
    .date-tag { font-size: 10px; color: var(--text-muted); font-weight: 600; }

    .match-body { padding: 15px; display: flex; align-items: center; justify-content: space-between; }
    .team-col { flex: 1; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .team-logo { width: 40px; height: 40px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; color: rgba(255,255,255,0.3); }
    .team-name { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #e2e8f0; line-height: 1.2; }
    
    .score-col { text-align: center; width: 80px; }
    .big-score { font-family: 'Oswald', sans-serif; font-size: 36px; font-weight: 700; line-height: 1; letter-spacing: -1px; }
    .match-result-badge { font-size: 9px; font-weight: 800; text-transform: uppercase; margin-top: 4px; padding: 2px 6px; border-radius: 4px; display: inline-block; }

    .match-footer { background: rgba(0,0,0,0.2); padding: 8px 15px; border-top: 1px solid var(--glass-border); display: flex; gap: 10px; overflow-x: auto; }
    .mini-stat { font-size: 10px; background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 6px; color: var(--text-muted); white-space: nowrap; }
    .mini-stat b { color: #fff; margin-right: 4px; }
    .ms-goal b { color: var(--success); } .ms-motm b { color: var(--warning); } .ms-mvp b { color: var(--gold); }

    /* === RECORDS === */
    .awards-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; margin-top: 20px; }
    .award-box { 
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8)); 
        padding: 16px; border-radius: 20px; border: 1px solid var(--glass-border); 
        text-align: center; position: relative; overflow: hidden;
    }
    .award-box.motm { border-color: rgba(16, 185, 129, 0.2); }
    .award-box.mvp { border-color: rgba(251, 191, 36, 0.2); }
    
    .award-icon { font-size: 24px; margin-bottom: 8px; display: block; filter: drop-shadow(0 0 10px currentColor); }
    .p-name-lg { font-family: 'Oswald', sans-serif; font-size: 15px; font-weight: 500; display: block; margin-bottom: 2px; }
    .p-count-sm { font-size: 10px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

    .leaderboard-list { display: flex; flex-direction: column; gap: 8px; }
    .lb-item { 
        background: var(--bg-card); padding: 12px 16px; border-radius: 14px; 
        display: flex; align-items: center; gap: 12px; border: 1px solid var(--glass-border);
        transition: transform 0.1s;
    }
    .lb-item:active { transform: scale(0.98); background: rgba(255,255,255,0.1); }
    
    .lb-rank { font-family: 'Oswald', sans-serif; font-size: 16px; color: var(--text-muted); width: 24px; text-align: center; }
    .lb-rank.r-1 { color: var(--gold); font-size: 20px; text-shadow: 0 0 10px rgba(251,191,36,0.3); }
    .lb-rank.r-2 { color: var(--silver); }
    .lb-rank.r-3 { color: var(--bronze); }
    
    .lb-info { flex: 1; }
    .lb-val { font-family: 'Oswald', sans-serif; font-size: 18px; color: var(--accent); font-weight: 700; }

    /* === SQUAD === */
    .squad-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
    .player-fut-card {
        background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
        border: 1px solid var(--glass-border); border-radius: 16px;
        padding: 15px; text-align: center; position: relative; overflow: hidden;
    }
    .p-avatar-lg {
        width: 50px; height: 50px; background: rgba(255,255,255,0.05); 
        border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .p-role { font-size: 9px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-bottom: 4px; }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; position: absolute; top: 10px; right: 10px; }

    /* === MODALS === */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9000; background: rgba(2,6,23,0.9); backdrop-filter: blur(8px); justify-content: center; align-items: center; padding: 20px; }
    .modal.active { display: flex; }
    .modal-content { 
        background: #1e293b; width: 100%; max-width: 380px; border-radius: 24px; 
        border: 1px solid rgba(255,255,255,0.1); overflow: hidden;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5); transform: translateY(20px); opacity: 0; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .modal.active .modal-content { opacity: 1; transform: translateY(0); }

    /* === HEADER MODAL YANG LEBIH RAPI & PRESISI === */
.m-header {
    background: radial-gradient(circle at top, #2563eb, #1e293b);
    padding: 20px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    position: relative;
    text-align: center;
}

/* Grid Layout: Kiri (Logo) - Tengah (Skor) - Kanan (Logo) */
/* Ini kuncinya supaya presisi */
.match-display-grid {
    display: grid;
    grid-template-columns: 1fr 1.4fr 1fr; 
    align-items: center;
    margin-top: 15px;
}

/* Kolom Tim */
.md-team-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.md-logo-circle {
    width: 50px;
    height: 50px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid rgba(255,255,255,0.15);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.md-team-name {
    font-size: 10px;
    font-weight: 700;
    color: #fff;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1.2;
}

/* Kotak Skor (Supaya terlihat seperti 'Tombol/Badge') */
.md-score-box {
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 10px 0;
    text-align: center;
    backdrop-filter: blur(4px);
    width: 100%;
}

.md-score-val {
    font-family: 'Oswald', sans-serif;
    font-size: 38px;
    font-weight: 700;
    color: #fff;
    line-height: 1;
    display: block;
    text-shadow: 0 0 10px rgba(255,255,255,0.3);
}

.md-status {
    font-size: 9px;
    color: var(--accent); /* Warna biru muda */
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-top: 4px;
    display: block;
    opacity: 0.9;
}

.md-league-top {
    font-size: 10px;
    font-weight: 600;
    color: rgba(255,255,255,0.6);
    text-transform: uppercase;
    letter-spacing: 1px;
}
    .timeline-container { padding: 20px; max-height: 250px; overflow-y: auto; background: #0f172a; }
    .timeline-item { display: flex; gap: 10px; margin-bottom: 12px; align-items: center; }
    .tl-icon { width: 24px; text-align: center; font-size: 12px; }
    .tl-content { background: rgba(255,255,255,0.05); flex: 1; padding: 8px 12px; border-radius: 8px; font-size: 11px; }
    .tl-content b { color: #fff; display: block; font-size: 12px; }
    
    .close-btn { width: 100%; padding: 16px; background: transparent; border: none; color: #fff; font-family: 'Oswald', sans-serif; font-size: 14px; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; border-top: 1px solid rgba(255,255,255,0.05); transition: 0.2s; }
    .close-btn:active { background: rgba(255,255,255,0.05); }

    /* === TAB BUTTONS (FIXED PREMIUM STYLE) === */
    .tab-nav { 
        background: rgba(255,255,255,0.05); padding: 4px; border-radius: 12px; display: flex; margin-bottom: 15px; 
        border: 1px solid var(--glass-border);
    }
    .tab-btn { 
        flex: 1; background: transparent; border: none; color: var(--text-muted); padding: 8px; 
        border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer; transition: 0.3s;
        -webkit-appearance: none; appearance: none; outline: none;
    }
    .tab-btn.active { 
        background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); 
    }

    /* === NAVBAR === */
    /* === NAVBAR OPSI 1: MODERN GLASS === */
.bottom-nav { 
    position: fixed; 
    bottom: 25px; 
    left: 50%; 
    transform: translateX(-50%); 
    width: 92%; 
    max-width: 400px; 
    background: rgba(15, 23, 42, 0.8); /* Lebih gelap agar kontras */
    backdrop-filter: blur(16px); 
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255,255,255,0.1); 
    border-radius: 24px; /* Sudut lebih bulat */
    display: flex; 
    justify-content: space-around; /* Jarak antar menu otomatis rapi */
    align-items: center;
    padding: 12px 10px; 
    z-index: 1000; 
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
}

.nav-item { 
    flex: 1;
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center;
    gap: 4px;
    color: var(--text-muted); 
    font-size: 10px; 
    font-weight: 500; 
    cursor: pointer; 
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 12px;
    padding: 8px 0; /* Area tekan lebih luas */
}

.nav-item i { 
    font-size: 20px; 
    margin-bottom: 2px; 
    transition: 0.3s;
}

/* Efek saat Aktif */
.nav-item.active { 
    color: #fff; 
    background: rgba(59, 130, 246, 0.15); /* Background biru transparan */
    transform: translateY(0); /* Reset transform lama */
}

.nav-item.active i { 
    color: var(--primary);
    filter: drop-shadow(0 0 8px var(--primary)); 
    transform: scale(1.1);
}

    /* Utilities */
    .hidden { display: none !important; }
</style>
</head>
<body>
    
    <!-- WELCOME SCREEN -->
    <div id="welcomeOverlay">
        <div class="intro-logo-container">
            <div class="intro-circle"></div>
            <img src="inter-milan-old.png" class="welcome-logo">
        </div>
        <div class="welcome-text-box">
            <div class="welcome-title">INTER MANILA</div>
            <div class="welcome-sub">OFFICIAL STATS CENTER</div>
        </div>
        <div class="loading-bar-container">
            <div class="loading-bar"></div>
        </div>
    </div>

    <header>
        <img src="inter-milan-old.png" class="logo-main" id="logoBtn">
        <h1>Inter Manila</h1>
    </header>

    <!-- ========== HOME PAGE ========== -->
    <div id="homePage" class="page-section active">
        <div class="container">
            <div class="dashboard-header">
                <div class="welcome-box">
                    <h2>Overview</h2>
                    <p id="currentSeasonLabel">All Time Stats</p>
                </div>
                
                <div style="position: relative;">
                    <div id="seasonBtn" class="custom-select-btn" onclick="toggleSeasonMenu()">
                        <span id="selectedSeasonText">All Time</span>
                        <i class="fa fa-chevron-down"></i>
                    </div>
                    <div id="seasonMenu" class="dropdown-menu"></div>
                    <!-- Pre-set All Time to ensure auto load -->
                    <select id="seasonFilter" style="display:none">
                        <option value="all" selected>All Time</option>
                    </select>
                </div>
            </div>

            <!-- AI Insight Card -->
            <div class="ai-card" id="aiCard">
                <div class="ai-header">
                    <div class="ai-badge"><i class="fa fa-user"></i> REPOSE</div>
                </div>
                <div class="ai-content typing-cursor" id="aiText">Analyzing season data...</div>
            </div>

            <div class="stats-grid">
                <!-- Win Rate Donut Chart -->
                <div class="stat-card winrate-card full-card">
                    <div class="winrate-content">
                        <h3>Win Rate</h3>
                        <div class="form-dots" id="matchForm"></div>
                    </div>
                    <div class="chart-container">
                        <div class="donut-chart" id="winRateChart" style="--percent: 0;">
                            <span class="chart-text" id="winRate">0%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <h3>Matches</h3>
                    <span class="val font-num" id="totalMatches">0</span>
                    <p class="stat-sub" id="wdlText">0W - 0D - 0L</p>
                </div>
                <div class="stat-card">
                    <h3>Honors</h3>
                    <span class="val font-num" id="totalRecords">0</span>
                    <div id="miniTrophyList" style="margin-top:8px; display:flex; flex-direction:column; gap:4px; font-size:10px;"></div>
                </div>
            </div>

            <div class="recent-box">
                <h4 style="margin:0 0 15px 0; font-size:12px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px;"><i class="fa fa-history"></i> Recent Activity</h4>
                <div id="recentActivity"></div>
            </div>
        </div>
    </div>

    <!-- ========== MATCHES PAGE ========== -->
    <div id="matchesPage" class="page-section">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; margin-top: 20px;">
                <h3 style="margin:0; font-size: 20px; color:#fff;">Match Center</h3>
                
                <div style="position: relative;">
                    <div id="matchSeasonBtn" class="custom-select-btn" onclick="toggleMatchSeasonMenu()">
                        <span id="selectedMatchSeasonText">All Time</span>
                        <i class="fa fa-chevron-down"></i>
                    </div>
                    <div id="matchSeasonMenu" class="dropdown-menu"></div>
                    <select id="matchFilter" style="display: none;">
                        <option value="all" selected>All Time</option>
                    </select>
                </div>
            </div>

            <div id="matchList">
                <div style="padding:40px; text-align:center; color:var(--text-muted);">
                    <i class="fa fa-spin fa-spinner" style="font-size:24px; margin-bottom:10px;"></i><br>Loading Data...
                </div>
            </div>
        </div>
    </div>

    <!-- ========== RECORDS PAGE ========== -->
    <div id="recordsPage" class="page-section">
        <div class="container">
            <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px; margin-top: 20px;">
                <div style="position: relative;">
                    <div id="recordSeasonBtn" class="custom-select-btn" onclick="toggleRecordSeasonMenu()">
                        <span id="selectedRecordSeasonText">All Time</span>
                        <i class="fa fa-chevron-down"></i>
                    </div>
                    <div id="recordSeasonMenu" class="dropdown-menu"></div>
                    <select id="recordsSeasonFilter" style="display: none;">
                        <option value="all" selected>All Time</option>
                    </select>
                </div>
            </div>

            <!-- Trophies -->
            <div id="trophyList" style="display:flex; flex-direction:column; gap:8px; margin-bottom:25px;"></div>

            <div class="awards-grid">
                <div class="award-box motm">
                    <i class="fa fa-medal award-icon" style="color:var(--success)"></i>
                    <span class="p-name-lg" id="bestMOTM">-</span>
                    <span class="p-count-sm" id="countMOTM">MOST MOTM</span>
                </div>
                <div class="award-box mvp">
                    <i class="fa fa-crown award-icon" style="color:var(--gold)"></i>
                    <span class="p-name-lg" id="bestMVP">-</span>
                    <span class="p-count-sm" id="countMVP">MOST MVP</span>
                </div>
            </div>

            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchRecord('goals', this)">Top Scorers</button>
                <button class="tab-btn" onclick="switchRecord('assists', this)">Assists</button>
                <button class="tab-btn" onclick="switchRecord('saves', this)">Saves</button>
            </div>

            <div id="goals" class="record-container active leaderboard-list"></div>
            <div id="assists" class="record-container leaderboard-list hidden"></div>
            <div id="saves" class="record-container leaderboard-list hidden"></div>
        </div>
    </div>

    <!-- ========== SQUAD PAGE ========== -->
    <div id="squadPage" class="page-section">
        <div class="container">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; margin-top: 20px;">
                <div>
                    <h2 style="font-size:24px; margin:0; color:#fff;">Squad</h2>
                    <p id="playerCount" style="margin:0; font-size:11px; color:var(--text-muted); font-weight:600;">Updating...</p>
                </div>
            </div>

            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchSquad('active', this)">Active Roster</button>
                <button class="tab-btn" onclick="switchSquad('ex', this)">Ex Players</button>
            </div>

            <div id="activeSquad" class="squad-container squad-grid active"></div>
            <div id="exSquad" class="squad-container squad-grid hidden"></div>
        </div>
    </div>

    <!-- ========== MODALS ========== -->
    <!-- Match Detail Modal with Timeline -->
<div id="mModal" class="modal">
    <div class="modal-content">
        
        <!-- HEADER BARU: LEBIH RAPI -->
        <div class="m-header">
            <!-- Label Liga di paling atas -->
            <div id="mLeague" class="md-league-top">LEAGUE INFO</div>

            <!-- Grid 3 Kolom -->
            <div class="match-display-grid">
                
                <!-- Kiri: Home -->
                <div class="md-team-col">
                    <div class="md-logo-circle">
                        <img src="inter-milan-old.png" style="width:30px;">
                    </div>
                    <div class="md-team-name">INTER</div>
                </div>

                <!-- Tengah: Skor Box -->
                <div class="md-score-box">
                    <span id="mScore" class="md-score-val">0 - 0</span>
                    <span class="md-status">Full Time</span>
                </div>

                <!-- Kanan: Away -->
                <div class="md-team-col">
                    <div class="md-logo-circle">
                        <i class="fa fa-shield" style="font-size:20px; color:rgba(255,255,255,0.6);"></i>
                    </div>
                    <div id="mOpponent" class="md-team-name">OPPONENT</div>
                </div>

            </div>
        </div>

        <!-- TIMELINE CONTAINER (TIDAK DIHAPUS, SESUAI PERMINTAAN) -->
        <div style="background:#0f172a; padding:15px 20px 5px; font-size:10px; color:var(--text-muted); font-weight:700; text-transform:uppercase;">
            Match Details
        </div>
        
        <div id="mStats" class="timeline-container">
            <!-- Item timeline akan masuk di sini via JS -->
        </div>

        <button onclick="closeMatchModal()" class="close-btn">Close Details</button>
    </div>
</div>

<!-- SEASON RECAP MODAL -->
<div id="recapModal" class="modal">
    <div class="modal-content" style="background: linear-gradient(160deg, #101012 0%, #050505 100%); border: 1px solid rgba(255, 215, 0, 0.15);">
        <div style="text-align:center; margin-bottom:20px;">
            <div id="recapIcon" style="font-size:40px; margin-bottom:10px; filter: drop-shadow(0 0 15px rgba(255,215,0,0.4));">üèÜ</div>
            <h2 id="recapTitle" style="margin:0; font-size:20px; color:#fff; font-weight:800; text-transform:uppercase; letter-spacing:1px;">Serie A</h2>
            <p id="recapSeason" style="margin:5px 0 0; color:var(--gold); font-weight:700; font-size:14px;">2023/2024</p>
        </div>

        <!-- Ringkasan Stats Season Itu -->
        <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); gap:8px; margin-bottom:25px;">
            <div class="stat-card" style="padding:12px; align-items:center; text-align:center;">
                <h3 style="font-size:9px; margin-bottom:4px;">Matches</h3>
                <span class="val" id="recapMatches" style="font-size:18px;">0</span>
            </div>
            <div class="stat-card" style="padding:12px; align-items:center; text-align:center;">
                <h3 style="font-size:9px; margin-bottom:4px;">Win Rate</h3>
                <span class="val" id="recapWinRate" style="font-size:18px; color:var(--success)">0%</span>
            </div>
            <div class="stat-card" style="padding:12px; align-items:center; text-align:center;">
                <h3 style="font-size:9px; margin-bottom:4px;">Goals</h3>
                <span class="val" id="recapGoals" style="font-size:18px; color:var(--primary)">0</span>
            </div>
        </div>

        <!-- Top Performers Season Itu -->
        <div style="background: rgba(255,255,255,0.03); border-radius:16px; padding:20px; border:1px solid rgba(255,255,255,0.05);">
            <h4 style="margin:0 0 15px; font-size:11px; color:var(--text-sec); text-transform:uppercase; letter-spacing:1px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:8px;">Season Top Performers</h4>
            
            <div class="stat-item" style="padding:8px 0;">
                <span style="display:flex; align-items:center; gap:10px;">
                    <i class="fa fa-shoe-prints" style="color:var(--primary); width:20px;"></i> Top Scorer
                </span>
                <b style="color:#fff;" id="recapTopScorer">-</b>
            </div>
            <div class="stat-item" style="padding:8px 0;">
                <span style="display:flex; align-items:center; gap:10px;">
                    <i class="fa fa-hands" style="color:var(--warning); width:20px;"></i> Top Assist
                </span>
                <b style="color:#fff;" id="recapTopAssist">-</b>
            </div>
            <div class="stat-item" style="padding:8px 0;">
                <span style="display:flex; align-items:center; gap:10px;">
                    <i class="fa fa-crown" style="color:var(--gold); width:20px;"></i> Most MVPs
                </span>
                <b style="color:#fff;" id="recapMVP">-</b>
            </div>
        </div>

        <button onclick="closeModal('recapModal')" class="btn-cancel btn-save" style="margin-top:25px;">Close Recap</button>
    </div>
</div>

    <!-- Player Profile Modal -->
    <div id="pModal" class="modal">
        <div class="modal-content">
            <div style="padding:30px; text-align:center; background: radial-gradient(circle at center, #1e293b, #020617);">
                <div style="width:70px; height:70px; background:#2563eb; border-radius:24px; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; box-shadow:0 0 20px rgba(37,99,235,0.4); transform:rotate(-3deg);">
                    <i class="fa fa-user" style="font-size:30px; color:#fff; transform:rotate(3deg);"></i>
                </div>
                <h2 id="mName" style="margin:0; color:#fff; font-size: 24px;">-</h2>
                <div id="mPos" style="font-size:10px; color:var(--accent); font-weight:700; text-transform:uppercase; margin-top:5px; letter-spacing:1px;">-</div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:1px; background:rgba(255,255,255,0.1);">
                <div style="background:#1e293b; padding:15px; text-align:center;">
                    <div style="font-size:9px; color:var(--text-muted); text-transform:uppercase;">Apps</div>
                    <b id="mApps" class="font-num" style="font-size:20px; color:#fff;">0</b>
                </div>
                <div style="background:#1e293b; padding:15px; text-align:center;">
                    <div style="font-size:9px; color:var(--text-muted); text-transform:uppercase;">Goals</div>
                    <b id="mGoals" class="font-num" style="font-size:20px; color:var(--success);">0</b>
                </div>
                <div style="background:#1e293b; padding:15px; text-align:center;">
                    <div style="font-size:9px; color:var(--text-muted); text-transform:uppercase;">Assists</div>
                    <b id="mAssists" class="font-num" style="font-size:20px; color:var(--warning);">0</b>
                </div>
                <div style="background:#1e293b; padding:15px; text-align:center;">
                    <div style="font-size:9px; color:var(--text-muted); text-transform:uppercase;">Saves</div>
                    <b id="mSaves" class="font-num" style="font-size:20px; color:var(--accent);">0</b>
                </div>
                <div style="background:#1e293b; padding:15px; text-align:center;">
                    <div style="font-size:9px; color:var(--text-muted); text-transform:uppercase;">MOTM</div>
                    <b id="mMOTM" class="font-num" style="font-size:20px; color:var(--gold);">0</b>
                </div>
                <div style="background:#1e293b; padding:15px; text-align:center;">
                    <div style="font-size:9px; color:var(--text-muted); text-transform:uppercase;">MVP</div>
                    <b id="mMVP" class="font-num" style="font-size:20px; color:var(--accent);">0</b>
                </div>
            </div>
            <button onclick="closePlayerModal()" class="close-btn">Close Card</button>
        </div>
    </div>

    <!-- ========== NAVIGATION ========== -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navigateTo('home')"><i class="fa fa-home"></i><span>Home</span></div>
        <div class="nav-item" onclick="navigateTo('matches')"><i class="fa fa-futbol"></i><span>Matches</span></div>
        <div class="nav-item" onclick="navigateTo('records')"><i class="fa fa-chart-simple"></i><span>Records</span></div>
        <div class="nav-item" onclick="navigateTo('squad')"><i class="fa fa-users"></i><span>Squad</span></div>
    </nav>

    <!-- LOGIC SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAuUcXmYjMU-XaL_w7h4y43RHku4dQGFlk",
            authDomain: "inter-manila.firebaseapp.com",
            projectId: "inter-manila",
            storageBucket: "inter-manila.firebasestorage.app",
            messagingSenderId: "285507279342",
            appId: "1:285507279342:web:5aa0c80a08fb92727416ff"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let allMatches = [];
        let allPlayers = [];
        let playerStats = {};

        // Navigation
        window.navigateTo = (page) => {
            const pageMap = { 'home': 'homePage', 'matches': 'matchesPage', 'records': 'recordsPage', 'squad': 'squadPage' };
            document.querySelectorAll('.page-section').forEach(p => {
                p.classList.remove('active');
                setTimeout(() => { if(!p.classList.contains('active')) p.style.display = 'none'; }, 400);
            });
            
            const target = document.getElementById(pageMap[page]);
            target.style.display = 'block';
            setTimeout(() => target.classList.add('active'), 20);

            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const navIndex = ['home', 'matches', 'records', 'squad'].indexOf(page);
            document.querySelectorAll('.nav-item')[navIndex].classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if (page === 'matches') renderMatches();
            if (page === 'records') processRecordsData();
            if (page === 'squad') processSquadData();
        };

        // Data Loading
        onSnapshot(query(collection(db, "trophies"), orderBy("timestamp", "desc")), (snapshot) => {
            document.getElementById('totalRecords').innerText = snapshot.size;
            const miniList = document.getElementById('miniTrophyList');
            miniList.innerHTML = snapshot.empty ? "No honors yet" : "";
            snapshot.docs.slice(0, 3).forEach(doc => {
                const t = doc.data();
                const color = t.rank === 'gold' ? 'var(--gold)' : (t.rank === 'silver' ? 'var(--silver)' : 'var(--bronze)');
                const rankText = t.rank === 'gold' ? '1st' : (t.rank === 'silver' ? '2nd' : '3rd');
                miniList.innerHTML += `
                <div style="display:flex; align-items:center; gap:8px;">
                    <i class="fa fa-trophy" style="color:${color}; width:15px; text-align:center;"></i>
                    <span style="color:#cbd5e1">${rankText} Place - ${t.name}</span>
                </div>`;
            });

            const fullList = document.getElementById('trophyList');
            fullList.innerHTML = snapshot.empty ? `<div style="text-align:center; color:#64748b; font-size:12px;">No trophies yet</div>` : "";
            snapshot.forEach(doc => {
                const t = doc.data();
                const r = t.rank || 'gold';
                const i = r === 'gold' ? 'fa-trophy' : (r === 'silver' ? 'fa-medal' : 'fa-award');
                const label = r === 'gold' ? 'CHAMPIONS' : (r === 'silver' ? 'RUNNER UP' : '3RD PLACE');
                const cVar = r === 'gold' ? 'var(--gold)' : (r === 'silver' ? 'var(--silver)' : 'var(--bronze)');
                
                fullList.innerHTML += `
                    <div class="lb-item" style="border-left: 3px solid ${cVar}">
                        <div style="width:30px; text-align:center;"><i class="fa ${i}" style="color:${cVar}; font-size:18px;"></i></div>
                        <div style="flex:1">
                            <b style="color:#fff; font-size:14px; display:block;">${t.name}</b>
                            <span style="color:var(--text-muted); font-size:10px;">${t.season}</span>
                        </div>
                        <div style="font-size:10px; font-weight:800; color:${cVar}; opacity:0.8;">${label}</div>
                    </div>`;
            });
        });

        onSnapshot(collection(db, "players"), (snapshot) => {
            allPlayers = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            processSquadData();
            processRecordsData();
        });

        onSnapshot(query(collection(db, "matches"), orderBy("timestamp", "desc")), (snapshot) => {
            allMatches = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            updateFilterDropdowns();
            
            // FORCE DEFAULT LOAD
            const sFilter = document.getElementById('seasonFilter');
            if(!sFilter.value) sFilter.value = 'all';
            
            renderHomePage(); 
            renderMatches();
            processSquadData();
            processRecordsData();
        });

        function updateFilterDropdowns() {
            const seasons = [...new Set(allMatches.map(m => `${m.league||''} ${m.season||''}`.trim()))].filter(Boolean).sort();
            const opts = `<option value="all">All Time</option>` + seasons.map(s => `<option value="${s}">${s}</option>`).join('');
            
            ['seasonFilter', 'matchFilter', 'recordsSeasonFilter'].forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    const currentVal = el.value || 'all'; 
                    el.innerHTML = opts;
                    el.value = currentVal;
                }
            });
        }

        // Logic: Home Page
        function renderHomePage() {
            const filterValue = document.getElementById('seasonFilter').value;
            let filtered = filterValue === 'all' ? allMatches : allMatches.filter(m => `${m.league||''} ${m.season||''}`.trim() === filterValue);
            
            let wins = 0, draws = 0, losses = 0;
            let recentHTML = "";
            let formHTML = "";
            let topScorerId = null; 
            let statsMap = {};

            filtered.forEach((m, i) => {
                const hs = parseInt(m.homeScore) || 0;
                const as = parseInt(m.awayScore) || 0;
                let result = hs > as ? 'W' : (hs < as ? 'L' : 'D');
                if (result === 'W') wins++; else if (result === 'L') losses++; else draws++;
                
                if (i < 5) {
                    formHTML = `<span class="dot dot-${result}"></span>` + formHTML;
                    recentHTML += `
                    <div class="activity-item" onclick="viewMatch(${allMatches.findIndex(x => x.id === m.id)})">
                        <div class="team-info">
                            <b>vs ${m.opponent}</b>
                            <small>${result === 'W' ? 'Won' : (result === 'L' ? 'Lost' : 'Draw')}</small>
                        </div>
                        <div class="score-pill" style="color:${result==='W'?'var(--success)':result==='L'?'var(--danger)':'var(--text-muted)'}">
                            ${hs}-${as}
                        </div>
                    </div>`;
                }

                // AI Data Prep
                if(m.scorers) {
                    m.scorers.forEach(s => {
                        if(!statsMap[s.name]) statsMap[s.name] = 0;
                        statsMap[s.name] += (parseInt(s.goals)||0);
                    });
                }
            });

            // Calculate Top Scorer for AI
            let maxGoals = 0;
            let topScorerName = "";
            for (const [name, goals] of Object.entries(statsMap)) {
                if(goals > maxGoals) { maxGoals = goals; topScorerName = name; }
            }

            // Update Stats
            const total = filtered.length;
            const winRate = total ? Math.round((wins / total) * 100) : 0;
            
            animateValue("totalMatches", parseInt(document.getElementById('totalMatches').innerText), total, 1000);
            document.getElementById('winRate').innerText = winRate + "%";
            document.getElementById('winRateChart').style.setProperty('--percent', winRate);
            document.getElementById('wdlText').innerText = `${wins}W - ${draws}D - ${losses}L`;
            document.getElementById('matchForm').innerHTML = formHTML || '<span class="dot"></span>';
            document.getElementById('recentActivity').innerHTML = recentHTML || '<p style="text-align:center; color:var(--text-muted); font-size:11px;">No matches found.</p>';
            document.getElementById('currentSeasonLabel').innerText = filterValue === 'all' ? "All Time Stats" : filterValue;

            // Trigger AI Analysis
            generateAISummary(wins, draws, losses, winRate, topScorerName, maxGoals, total);
        }

        // NEW: AI Summary Logic with Varied Dialogues
        function generateAISummary(wins, draws, losses, winRate, topScorer, goals, total) {
            const aiText = document.getElementById('aiText');
            let responses = [];

            if (total === 0) {
                responses = [
                    "Awaiting match data to initialize tactical analysis.",
                    "Season hasn't started yet. Ready to analyze performance.",
                    "No data available. The slate is clean."
                ];
            } else if (winRate >= 70) {
                responses = [
                    `Exceptional form! A ${winRate}% win rate shows domination. ${topScorer ? topScorer + " is leading the line brilliantly." : "The team chemistry is unstoppable."}`,
                    `Championship material. Winning ${wins} out of ${total} games is no fluke. Defense and attack are perfectly balanced.`,
                    `The squad is firing on all cylinders! ${topScorer ? "With " + topScorer + " scoring for fun," : ""} opponents are struggling to keep up.`,
                    `Incredible momentum. A ${winRate}% win rate strikes fear into any opponent. Keep pushing!`
                ];
            } else if (winRate >= 50) {
                responses = [
                    `Solid performance. ${wins} wins shows quality, but converting those draws into wins is the next step.`,
                    `A balanced season so far with a ${winRate}% win rate. ${topScorer ? topScorer + " is key to our success." : "Consistency will be crucial moving forward."}`,
                    `Good foundation. We are tough to beat, but need that extra edge to dominate matches completely.`,
                    `Decent run of form. The potential is there to climb higher if we tighten up the defense.`
                ];
            } else if (winRate >= 30) {
                responses = [
                    `A challenging period with ${losses} losses. We need to turn those close games into points.`,
                    `The ${winRate}% win rate doesn't tell the whole story. The team fights hard but needs more precision in the final third.`,
                    `Grinding for results. Defense needs to stay sharp to improve consistency. Every match is a battle.`,
                    `Room for improvement. Converting chances is vital to turning this season around.`
                ];
            } else {
                responses = [
                    `Tough times for the squad. Regrouping is needed to improve the ${winRate}% win rate immediately.`,
                    `We are struggling to find rhythm. Hard work on the training ground is essential to fix defensive gaps.`,
                    `A difficult run. The team needs to show character and bounce back in the next fixture.`,
                    `Results haven't gone our way. Focus and discipline are required to stop the slide.`
                ];
            }

            // Select random response
            const summary = responses[Math.floor(Math.random() * responses.length)];

            // Typing effect
            aiText.innerText = "";
            let i = 0;
            const typeWriter = () => {
                if (i < summary.length) {
                    aiText.innerHTML += summary.charAt(i);
                    i++;
                    setTimeout(typeWriter, 15); 
                } else {
                    document.querySelector('.typing-cursor').classList.remove('typing-cursor');
                }
            };
            typeWriter();
        }

        function animateValue(id, start, end, duration) {
            if (start === end) return;
            const range = end - start;
            let current = start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));
            const obj = document.getElementById(id);
            const timer = setInterval(() => {
                current += increment;
                obj.innerText = current;
                if (current == end) clearInterval(timer);
            }, stepTime);
        }

        // Logic: View Match Details (Modal)
        window.viewMatch = (idx) => {
            const m = allMatches[idx];
            document.getElementById('mLeague').innerText = `${m.league} ‚Ä¢ ${m.season}`;
            document.getElementById('mOpponent').innerText = m.opponent;
            document.getElementById('mScore').innerText = `${m.homeScore}-${m.awayScore}`;
            
            const statsDiv = document.getElementById('mStats');
            let timelineHTML = "";
            
            const relevantScorers = m.scorers ? m.scorers.filter(s => s.goals > 0 || s.assists > 0 || s.saves > 0) : [];
            
            if(relevantScorers.length > 0) {
                relevantScorers.forEach(s => {
                    if(s.goals > 0) timelineHTML += `<div class="timeline-item"><div class="tl-icon"><i class="fa fa-futbol" style="color:var(--success)"></i></div><div class="tl-content"><b>${s.name}</b>Scored ${s.goals} goal(s)</div></div>`;
                    if(s.assists > 0) timelineHTML += `<div class="timeline-item"><div class="tl-icon"><i class="fa fa-handshake" style="color:var(--warning)"></i></div><div class="tl-content"><b>${s.name}</b>Provided ${s.assists} assist(s)</div></div>`;
                    if(s.saves > 0) timelineHTML += `<div class="timeline-item"><div class="tl-icon"><i class="fa fa-mitten" style="color:var(--accent)"></i></div><div class="tl-content"><b>${s.name}</b>Made ${s.saves} save(s)</div></div>`;
                });
            }

            if (m.motmId) {
                let motmName = "Unknown";
                if(m.scorers) { const s = m.scorers.find(p => p.id === m.motmId); if(s) motmName = s.name; }
                if(motmName === "Unknown") { const p = allPlayers.find(pl => pl.id === m.motmId); if(p) motmName = p.name; }
                timelineHTML += `<div class="timeline-item" style="border:1px solid rgba(251, 191, 36, 0.3); border-radius:8px; background:rgba(251, 191, 36, 0.05);"><div class="tl-icon"><i class="fa fa-star" style="color:var(--gold)"></i></div><div class="tl-content" style="background:none;"><b>Man of the Match</b>${motmName}</div></div>`;
            }

            if (m.mvpId) {
                let mvpName = "Unknown";
                if(m.scorers) { const s = m.scorers.find(p => p.id === m.mvpId); if(s) mvpName = s.name; }
                if(mvpName === "Unknown") { const p = allPlayers.find(pl => pl.id === m.mvpId); if(p) mvpName = p.name; }
                timelineHTML += `<div class="timeline-item" style="border:1px solid rgba(96, 165, 250, 0.3); border-radius:8px; background:rgba(96, 165, 250, 0.05);"><div class="tl-icon"><i class="fa fa-crown" style="color:var(--accent)"></i></div><div class="tl-content" style="background:none;"><b>Most Valuable Player</b>${mvpName}</div></div>`;
            }

            if(timelineHTML === "") timelineHTML = '<p style="text-align:center; color:#64748b; font-size:11px; padding:20px;">No specific stats recorded.</p>';
            statsDiv.innerHTML = timelineHTML;
            const modal = document.getElementById('mModal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
        };

        window.closeMatchModal = () => {
            const modal = document.getElementById('mModal');
            modal.classList.remove('active');
            setTimeout(() => { modal.style.display = 'none'; }, 300);
        };

        function renderMatches() {
            const list = document.getElementById('matchList');
            const selectedFilter = document.getElementById('matchFilter').value;
            const filtered = selectedFilter === 'all' ? allMatches : allMatches.filter(m => `${m.league||''} ${m.season||''}`.trim() === selectedFilter);

            if (filtered.length === 0) { list.innerHTML = '<p style="text-align:center; color:var(--text-muted); font-size:11px; padding:40px;">No matches found.</p>'; return; }

            list.innerHTML = filtered.map((m, idx) => {
                const h = parseInt(m.homeScore) || 0;
                const a = parseInt(m.awayScore) || 0;
                let resultClass = h > a ? 'var(--success)' : (h < a ? 'var(--danger)' : 'var(--text-muted)');
                let resultText = h > a ? 'W' : (h < a ? 'L' : 'D');
                const dateStr = m.timestamp?.toDate ? m.timestamp.toDate().toLocaleDateString('en-GB', { day: '2-digit', month: 'short' }) : 'Recently';
                let goalsStr = "", motmStr = "", mvpStr = "";
                
                if(m.scorers) {
                    const scorers = m.scorers.filter(s => s.goals > 0).map(s => s.name.split(' ')[0]);
                    if(scorers.length) goalsStr = `<div class="mini-stat ms-goal"><b>‚öΩ</b>${scorers.join(', ')}</div>`;
                    if(m.motmId) { const motm = m.scorers.find(s => s.id === m.motmId); if(motm) motmStr = `<div class="mini-stat ms-motm"><b>‚≠ê</b>${motm.name.split(' ')[0]}</div>`; }
                }
                if(m.mvpId) {
                     let mvpName = "MVP";
                     if(m.scorers) { const s = m.scorers.find(x => x.id === m.mvpId); if(s) mvpName = s.name.split(' ')[0]; }
                     mvpStr = `<div class="mini-stat ms-mvp"><b>üëë</b>${mvpName}</div>`;
                }

                return `
                <div class="match-card" onclick="viewMatch(${allMatches.findIndex(x => x.id === m.id)})">
                    <div class="match-header"><span class="league-tag">${m.league} <span style="color:var(--text-muted); margin-left:4px; font-weight:400;">${m.season || ''}</span></span><span class="date-tag">${dateStr}</span></div>
                    <div class="match-body">
                        <div class="team-col"><div class="team-logo"><img src="inter-milan-old.png" style="width:100%"></div><span class="team-name">Inter</span></div>
                        <div class="score-col"><div class="big-score">${h}-${a}</div><span class="match-result-badge" style="background:${resultClass}20; color:${resultClass}">${resultText}</span></div>
                        <div class="team-col"><div class="team-logo"><i class="fa fa-shield"></i></div><span class="team-name">${m.opponent}</span></div>
                    </div>
                    ${(goalsStr || motmStr || mvpStr) ? `<div class="match-footer">${goalsStr}${motmStr}${mvpStr}</div>` : ''}
                </div>`;
            }).join('');
        }

        function processRecordsData() {
            const filterValue = document.getElementById('recordsSeasonFilter').value;
            const filtered = filterValue === 'all' ? allMatches : allMatches.filter(m => `${m.league||''} ${m.season||''}`.trim() === filterValue);
            
            playerStats = {};
            allPlayers.forEach(p => playerStats[p.id] = { ...p, goals: 0, assists: 0, saves: 0, apps: 0, motm: 0, mvp: 0 });
            filtered.forEach(m => {
                if (m.motmId && playerStats[m.motmId]) playerStats[m.motmId].motm++;
                if (m.mvpId && playerStats[m.mvpId]) playerStats[m.mvpId].mvp++;
                const playedInMatch = new Set();
                if (m.scorers) {
                    m.scorers.forEach(s => {
                        if (playerStats[s.id]) {
                            playerStats[s.id].goals += (parseInt(s.goals) || 0);
                            playerStats[s.id].assists += (parseInt(s.assists) || 0);
                            playerStats[s.id].saves += (parseInt(s.saves) || 0);
                            playedInMatch.add(s.id);
                        }
                    });
                }
                playedInMatch.forEach(id => playerStats[id].apps++);
            });
            const list = Object.values(playerStats);
            const topMOTM = [...list].sort((a, b) => b.motm - a.motm)[0];
            const topMVP = [...list].sort((a, b) => b.mvp - a.mvp)[0];
            document.getElementById('bestMOTM').innerText = (topMOTM?.motm > 0) ? topMOTM.name : "-";
            document.getElementById('countMOTM').innerText = `${topMOTM?.motm || 0} AWARDS`;
            document.getElementById('bestMVP').innerText = (topMVP?.mvp > 0) ? topMVP.name : "-";
            document.getElementById('countMVP').innerText = `${topMVP?.mvp || 0} AWARDS`;
            renderLeaderboard('goals', list, 'goals');
            renderLeaderboard('assists', list, 'assists');
            renderLeaderboard('saves', list, 'saves');
        }

        function renderLeaderboard(id, data, field) {
            const sorted = data.filter(p => p[field] > 0).sort((a, b) => b[field] - a[field]).slice(0, 10);
            document.getElementById(id).innerHTML = sorted.map((p, i) => {
                const rankClass = i === 0 ? 'r-1' : (i === 1 ? 'r-2' : (i === 2 ? 'r-3' : ''));
                return `<div class="lb-item" onclick="showPlayerModal('${p.id}')"><div class="lb-rank ${rankClass}">${i+1}</div><div class="lb-info"><b style="color:#fff; font-size:13px; display:block;">${p.name}</b><span style="font-size:10px; color:var(--text-muted); text-transform:uppercase;">${p.pos || 'Plyr'}</span></div><div class="lb-val">${p[field]}</div></div>`;
            }).join('') || '<div style="text-align:center; padding:20px; color:var(--text-muted); font-size:11px;">No records found.</div>';
        }

        // Updated Switch Logic (Scoped to Parent to prevent cross-contamination)
        window.switchRecord = (id, btn) => {
            document.querySelectorAll('.record-container').forEach(c => c.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            // Remove active from sibling buttons only
            btn.parentNode.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        function processSquadData() {
            playerStats = {};
            allPlayers.forEach(p => playerStats[p.id] = { ...p, goals: 0, assists: 0, saves: 0, apps: 0, motm: 0, mvp: 0 });
            allMatches.forEach(m => {
                if (m.motmId && playerStats[m.motmId]) playerStats[m.motmId].motm++;
                if (m.mvpId && playerStats[m.mvpId]) playerStats[m.mvpId].mvp++;
                const played = new Set();
                if(m.scorers) m.scorers.forEach(s => {
                    if(playerStats[s.id]) {
                        playerStats[s.id].goals += (parseInt(s.goals)||0);
                        playerStats[s.id].assists += (parseInt(s.assists)||0);
                        playerStats[s.id].saves += (parseInt(s.saves)||0);
                        played.add(s.id);
                    }
                });
                played.forEach(id => playerStats[id].apps++);
            });
            const active = allPlayers.filter(p => p.active !== false).sort((a,b) => a.name.localeCompare(b.name));
            const ex = allPlayers.filter(p => p.active === false).sort((a,b) => a.name.localeCompare(b.name));
            document.getElementById('playerCount').innerText = `${active.length} Players Registered`;
            const renderCards = (list, containerId) => {
                const container = document.getElementById(containerId);
                if(list.length === 0) { container.innerHTML = "<p>No players</p>"; return; }
                container.innerHTML = list.map(p => {
                    const pos = Array.isArray(p.pos) ? p.pos[0] : (p.pos || 'PLY');
                    return `<div class="player-fut-card" onclick="showPlayerModal('${p.id}')"><div class="status-dot" style="background:${p.active!==false?'var(--success)':'var(--text-muted)'}"></div><div class="p-avatar-lg"><i class="fa fa-user"></i></div><span class="p-role">${pos}</span><b style="display:block; font-size:13px; color:#fff; margin-top:5px;">${p.name.split(' ')[0]}</b><div style="font-size:9px; color:var(--text-muted); margin-top:2px;">${playerStats[p.id].apps} Apps</div></div>`;
                }).join('');
            };
            renderCards(active, 'activeSquad');
            renderCards(ex, 'exSquad');
        }

        // Updated Switch Logic (Scoped to Parent)
        window.switchSquad = (type, btn) => {
            document.querySelectorAll('.squad-container').forEach(c => c.classList.add('hidden'));
            document.getElementById(type === 'active' ? 'activeSquad' : 'exSquad').classList.remove('hidden');
            // Remove active from sibling buttons only
            btn.parentNode.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        window.showPlayerModal = (id) => {
            const p = playerStats[id];
            if(!p) return;
            document.getElementById('mName').innerText = p.name;
            document.getElementById('mPos').innerText = Array.isArray(p.pos) ? p.pos.join(' / ') : (p.pos || 'Player');
            document.getElementById('mApps').innerText = p.apps;
            document.getElementById('mGoals').innerText = p.goals;
            document.getElementById('mAssists').innerText = p.assists;
            document.getElementById('mSaves').innerText = p.saves;
            document.getElementById('mMOTM').innerText = p.motm || 0;
            document.getElementById('mMVP').innerText = p.mvp || 0;
            const modal = document.getElementById('pModal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
        };
        window.closePlayerModal = () => {
            const modal = document.getElementById('pModal');
            modal.classList.remove('active');
            setTimeout(() => { modal.style.display = 'none'; }, 200);
        };

        const toggleMenu = (menuId, btnId) => {
            const menu = document.getElementById(menuId);
            const isVisible = menu.style.display === 'block';
            document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none');
            if(!isVisible) {
                const select = document.querySelector(`#${btnId} + div + select`) || document.querySelector(`#${btnId}`).parentNode.querySelector('select');
                menu.innerHTML = "";
                Array.from(select.options).forEach(opt => {
                    menu.innerHTML += `<div class="d-item" onclick="selectItem('${select.id}', '${opt.value}', '${opt.text}')">${opt.text} ${opt.value === select.value ? '<i class="fa fa-check" style="font-size:10px"></i>' : ''}</div>`;
                });
                menu.style.display = 'block';
            }
        };

        window.toggleSeasonMenu = () => toggleMenu('seasonMenu', 'seasonBtn');
        window.toggleMatchSeasonMenu = () => toggleMenu('matchSeasonMenu', 'matchSeasonBtn');
        window.toggleRecordSeasonMenu = () => toggleMenu('recordSeasonMenu', 'recordSeasonBtn');

        window.selectItem = (selectId, val, text) => {
            const select = document.getElementById(selectId);
            select.value = val;
            select.dispatchEvent(new Event('change')); 
            if(selectId === 'seasonFilter') { document.getElementById('selectedSeasonText').innerText = text; renderHomePage(); }
            else if(selectId === 'matchFilter') { document.getElementById('selectedMatchSeasonText').innerText = text; renderMatches(); }
            else if(selectId === 'recordsSeasonFilter') { document.getElementById('selectedRecordSeasonText').innerText = text; processRecordsData(); }
            document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none');
        };

        window.addEventListener('click', (e) => { if(!e.target.closest('.custom-select-btn')) { document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none'); } });
        
        window.addEventListener('load', () => { setTimeout(() => document.getElementById('welcomeOverlay').classList.add('fade-out'), 3500); });
        
        let tapCount = 0, tapTimeout;
        document.getElementById('logoBtn').onclick = () => { tapCount++; clearTimeout(tapTimeout); tapTimeout = setTimeout(() => tapCount = 0, 2000); if(tapCount >= 5) window.location.href = "login.html"; };
        
    </script>
</body>
</html>
