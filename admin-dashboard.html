<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inter Manila ‚Äî Admin Center</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <style>
        :root {
            --primary: #2563eb; --primary-glow: rgba(37, 99, 235, 0.4); --dark: #020617;
            --surface: #1e293b; --accent: #60a5fa; --success: #10b981; --danger: #ef4444;
            --warning: #f59e0b; --gold: #fbbf24; --silver: #94a3b8; --bronze: #d97706;
        }

        * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; }

        body { 
            display: none; margin: 0; font-family: 'Segoe UI', sans-serif; 
            background: radial-gradient(circle at top, #0f172a, #020617); 
            color: #f1f5f9; min-height: 100vh; padding-bottom: 80px; overflow-x: hidden;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        header { 
            text-align: center; padding: 40px 0 25px; 
            background: rgba(15, 23, 42, 0.9); border-bottom: 1px solid rgba(255,255,255,0.05); 
            position: relative; animation: fadeIn 0.5s ease;
        }
        header img { width: 50px; margin-bottom: 12px; filter: drop-shadow(0 0 15px var(--primary-glow)); }
        header h1 { margin: 0; font-size: 18px; color: var(--primary); text-transform: uppercase; letter-spacing: 4px; font-weight: 800; }

        .logout-btn { position: absolute; top: 25px; right: 20px; color: var(--danger); font-size: 18px; cursor: pointer; opacity: 0.6; padding: 10px; transition: 0.3s; }
        .logout-btn:active { opacity: 1; transform: scale(0.9); }

        nav { 
            display: flex; justify-content: center; padding: 12px; gap: 8px; 
            background: rgba(15, 23, 42, 0.95); position: sticky; top: 0; 
            z-index: 100; backdrop-filter: blur(15px); border-bottom: 1px solid rgba(255,255,255,0.05); 
        }
        nav a { 
            text-decoration: none; background: rgba(30, 41, 59, 0.4); 
            color: #64748b; padding: 10px 16px; border-radius: 14px; 
            font-size: 11px; font-weight: 700; display: flex; align-items: center; gap: 8px; 
            transition: 0.3s; cursor: pointer;
        }
        nav a.active { background: var(--primary); color: white; box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3); }

        .container { max-width: 500px; margin: 25px auto; padding: 0 20px; }

        /* === PAGE SECTIONS === */
        .page-section { display: none; animation: fadeIn 0.3s ease-out; }
        .page-section.active { display: block; }

        /* === BUTTONS === */
        .btn-add { 
            width: 100%; padding: 16px; background: linear-gradient(135deg, var(--primary), #1d4ed8); 
            color: white; border: none; border-radius: 18px; font-weight: 800; font-size: 12px;
            cursor: pointer; margin-bottom: 25px; letter-spacing: 1.5px; text-transform: uppercase;
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.2); transition: 0.3s;
        }
        .btn-add:active { transform: scale(0.98); opacity: 0.9; }
        .btn-add.success { background: linear-gradient(135deg, var(--success), #059669); box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2); }

        /* === DASHBOARD STYLES === */
        .dashboard-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 25px; }
        .welcome-box h2 { font-size: 26px; font-weight: 800; margin: 0; letter-spacing: -0.5px; }
        .welcome-box p { color: var(--accent); font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px; margin: 5px 0 0; }

        select { 
            background: #1e293b; color: white; border: 1px solid rgba(255,255,255,0.1); 
            padding: 8px 12px; border-radius: 12px; font-size: 11px; font-weight: 700; cursor: pointer;
        }

        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .stat-card { 
            background: rgba(30, 41, 59, 0.4); border-radius: 24px; padding: 20px; 
            border: 1px solid rgba(255, 255, 255, 0.06); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        .stat-card h3 { margin: 0; font-size: 9px; text-transform: uppercase; color: #64748b; letter-spacing: 1.2px; font-weight: 800; }
        .stat-card .val { font-size: 28px; font-weight: 900; margin: 6px 0; display: block; color: #fff; }
        .stat-sub { font-size: 10px; color: var(--accent); font-weight: 700; text-transform: uppercase; margin: 0; text-align: center; }

        .full-card { grid-column: span 2; }
        .trophy-card { grid-column: span 2; border: 1px solid rgba(245, 158, 11, 0.15); padding: 18px 20px; align-items: stretch; }
        
        .mini-trophy-list { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }
        .mini-t-item { display: flex; align-items: center; gap: 10px; font-size: 12px; font-weight: 600; color: #cbd5e1; }
        .mini-t-item i { font-size: 14px; }
        .mini-t-item span { margin-left: auto; font-size: 10px; color: #64748b; font-weight: 800; }

        .activity-item { 
            padding: 14px 12px; border-bottom: 1px solid rgba(255,255,255,0.03); 
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; border-radius: 16px; margin: 0 -5px; transition: 0.2s;
        }
        .activity-item:active { background: rgba(255,255,255,0.05); }
        .activity-item:last-child { border: none; }

        .team-info b { font-size: 14px; color: #fff; display: block; margin-bottom: 2px; }
        .team-info small { font-size: 9px; color: #64748b; font-weight: 700; text-transform: uppercase; }

        .score-pill { padding: 6px 0; border-radius: 10px; font-weight: 800; font-size: 14px; background: #020617; border: 1px solid rgba(255,255,255,0.08); min-width: 55px; text-align: center; }

        .form-dots { display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 5px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }
        .dot-W { background: var(--success); box-shadow: 0 0 10px var(--success); }
        .dot-L { background: var(--danger); box-shadow: 0 0 10px var(--danger); }
        .dot-D { background: #64748b; }

        /* === SQUAD STYLES === */
        .player-card { 
            background: rgba(30, 41, 59, 0.4); border-radius: 24px; padding: 20px; 
            margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.06); 
            backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: space-between;
        }
        .player-card.inactive { opacity: 0.5; filter: grayscale(0.5); border-style: dashed; }

        .player-actions { display: flex; gap: 15px; }
        .player-actions i { cursor: pointer; font-size: 18px; padding: 5px; transition: 0.2s; }
        .player-actions .fa-edit { color: var(--accent); }
        .player-actions .fa-trash { color: var(--danger); }
        .player-actions .fa-toggle-on { color: var(--success); }
        .player-actions .fa-toggle-off { color: #64748b; }

        .pos-badge { 
            display: inline-block; background: rgba(96, 165, 250, 0.1); color: var(--accent); 
            font-size: 9px; font-weight: 900; padding: 4px 10px; border-radius: 8px; 
            text-transform: uppercase; letter-spacing: 1px; margin-top: 8px; margin-right: 4px;
        }
        .p-name { font-size: 17px; font-weight: 800; color: #fff; display: block; }
        .p-status { font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase; margin-top: 3px; display: block;}

        /* === MATCHES STYLES === */
        .match-card { 
            background: rgba(30, 41, 59, 0.4); border-radius: 28px; padding: 25px; 
            margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.06); 
            position: relative; backdrop-filter: blur(10px); 
        }
        .match-actions { position: absolute; top: 18px; right: 18px; display: flex; gap: 12px; z-index: 10; }
        .match-actions i { cursor: pointer; font-size: 14px; transition: 0.2s; padding: 5px; opacity: 0.5; }
        .match-actions i:hover { opacity: 1; }

        .league-badge { 
            display: inline-block; background: rgba(37, 99, 235, 0.15); color: var(--accent); 
            font-size: 9px; font-weight: 800; padding: 5px 12px; border-radius: 10px; 
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; 
        }
        
        .score-row { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; gap: 10px; }
        .team-name { flex: 1; font-weight: 800; font-size: 13px; color: #fff; text-transform: uppercase; letter-spacing: 0.5px; }
        .score-center { text-align: center; min-width: 100px; }
        .agg-score { font-size: 38px; font-weight: 900; color: #fff; letter-spacing: -1px; line-height: 1; }

        .stats-box { 
            background: rgba(15, 23, 42, 0.4); border-radius: 18px; padding: 12px; 
            margin-top: 18px; border: 1px solid rgba(255,255,255,0.03); 
        }
        .stat-item { display: flex; justify-content: space-between; padding: 8px 4px; border-bottom: 1px solid rgba(255,255,255,0.03); align-items: center; }
        .stat-item:last-child { border-bottom: none; }
        .stat-player { font-size: 12px; font-weight: 600; color: #cbd5e1; display: flex; align-items: center; gap: 6px; }
        .stat-player small { font-size: 9px; color: var(--accent); font-weight: 800; text-transform: uppercase; }
        .stat-vals { font-size: 10px; font-weight: 800; color: #64748b; }
        .stat-vals b { color: var(--accent); margin-left: 4px; }

        /* === RECORDS STYLES === */
        .trophy-section { 
            background: rgba(30, 41, 59, 0.4); border-radius: 28px; padding: 20px; 
            margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.05); 
        }
        .section-label { 
            font-size: 10px; font-weight: 800; color: var(--accent); text-transform: uppercase; 
            margin-bottom: 15px; display: flex; justify-content: space-between; letter-spacing: 1px; 
        }
        
        .t-row { 
            display: flex; align-items: center; gap: 12px; background: rgba(0,0,0,0.2); 
            padding: 12px 15px; border-radius: 18px; margin-bottom: 10px; 
            border: 1px solid rgba(255,255,255,0.03); 
        }
        .t-gold { color: var(--gold); } 
        .t-silver { color: var(--silver); } 
        .t-bronze { color: var(--bronze); }

        .awards-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .award-box { 
            background: #1e293b; padding: 20px 15px; border-radius: 25px; 
            border: 1px solid rgba(255,255,255,0.08); text-align: center; 
        }
        .award-box i { font-size: 24px; margin-bottom: 8px; display: block; }
        .award-box.motm i { color: var(--success); } 
        .award-box.mvp i { color: var(--gold); }
        .award-box b { display: block; font-size: 14px; color: #fff; margin-bottom: 2px; }
        .award-box small { font-size: 9px; color: #64748b; text-transform: uppercase; font-weight: 800; }

        .admin-summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .admin-summary .stat-card { padding: 15px 5px; }
        .admin-summary .stat-card b { display: block; font-size: 20px; color: #fff; margin-bottom: 2px; }
        .admin-summary .stat-card small { font-size: 8px; color: #64748b; text-transform: uppercase; font-weight: 800; }

        .tab-nav { display: flex; background: rgba(15, 23, 42, 0.6); padding: 6px; border-radius: 20px; margin-bottom: 20px; gap: 6px; }
        .tab-btn { flex: 1; border: none; background: none; color: #64748b; padding: 12px; border-radius: 15px; font-weight: 800; font-size: 10px; cursor: pointer; transition: 0.3s; text-transform: uppercase; }
        .tab-btn.active { background: var(--primary); color: white; }

        .record-container { display: none; } 
        .record-container.active { display: block; }

        .player-row { 
            background: rgba(30, 41, 59, 0.3); border-radius: 20px; padding: 16px; 
            margin-bottom: 10px; display: flex; align-items: center; position: relative; 
            overflow: hidden; cursor: pointer; border: 1px solid rgba(255,255,255,0.03); 
        }
        .progress-bar { 
            position: absolute; left: 0; top: 0; bottom: 0; 
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.15), transparent); 
            border-left: 4px solid var(--primary); z-index: 0; transition: 0.5s ease-out; 
        }

        /* === MODALS === */
        .modal { 
            display: none; position: fixed; inset: 0; z-index: 1000; 
            background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(15px); 
            padding: 20px; align-items: center; justify-content: center; overflow-y: auto;
        }
        .modal.active { display: flex; }
        .modal-content { 
            background: #1e293b; width: 100%; max-width: 450px; margin: auto;
            border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); padding: 30px; 
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }

        input { 
            width: 100%; padding: 14px; margin-bottom: 12px; background: #0f172a; 
            border: 1px solid rgba(255,255,255,0.08); color: #fff; border-radius: 14px; 
            font-size: 13px; font-weight: 600; font-family: inherit;
        }
        label { 
            font-size: 9px; font-weight: 800; color: var(--accent); text-transform: uppercase; 
            display: block; margin-bottom: 6px; letter-spacing: 1px; padding-left: 4px;
        }

        .pos-selector { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 25px; }
        .pos-opt { 
            background: #0f172a; border: 1px solid rgba(255,255,255,0.1); padding: 12px 0; 
            text-align: center; border-radius: 12px; font-size: 11px; font-weight: 800; 
            color: #64748b; cursor: pointer; transition: 0.3s; 
        }
        .pos-opt.selected { background: var(--primary); color: white; border-color: var(--accent); box-shadow: 0 5px 12px rgba(37, 99, 235, 0.3); }

        .score-input-group { display: grid; grid-template-columns: 1fr 30px 1fr; gap: 10px; align-items: center; margin-bottom: 15px; }
        .score-input-group input { text-align: center; font-size: 22px; font-weight: 900; margin: 0; padding: 10px; }

        .p-chip { 
            display: block; padding: 12px 15px; background: rgba(255,255,255,0.03); 
            border-radius: 12px; margin-bottom: 6px; font-size: 12px; cursor: pointer; 
            border: 1px solid rgba(255,255,255,0.05); transition: 0.2s; 
        }
        .p-chip b { color: var(--accent); margin-right: 8px; font-size: 10px; }
        .p-chip.selected { background: rgba(37, 99, 235, 0.2); border-color: var(--primary); }

        .stat-input-row { 
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 6px; 
            margin-bottom: 6px; align-items: center; background: rgba(0,0,0,0.2); 
            padding: 8px 12px; border-radius: 12px; 
        }
        .stat-input-row span { font-size: 11px; font-weight: 700; color: #fff; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .stat-input-row input { padding: 8px 4px; margin: 0; text-align: center; font-size: 11px; border: none; background: #1e293b; }

        .p-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .p-stat-item { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.03); }
        .p-stat-item b { color: var(--accent); font-size: 20px; display: block; }
        .p-stat-item small { font-size: 9px; color: #64748b; text-transform: uppercase; font-weight: 800; }

        .btn-cancel, .btn-close { 
            width: 100%; background: none; border: none; color: #64748b; 
            font-weight: 800; font-size: 11px; cursor: pointer; margin-top: 15px; 
            letter-spacing: 1px; padding: 10px;
        }

        .modal-title { text-align: center; margin-bottom: 10px; }
        .modal-title h4 { margin: 0; font-size: 10px; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; }
        .modal-title h2 { margin: 8px 0; font-size: 22px; font-weight: 800; color: #fff; }

        .modal-score-big { 
            display: flex; justify-content: center; align-items: center; gap: 20px; 
            margin: 25px 0; background: rgba(15, 23, 42, 0.4); padding: 20px; border-radius: 20px;
        }
        .modal-score-big span { font-size: 42px; font-weight: 900; color: #fff; }
        .modal-score-big small { font-size: 12px; font-weight: 800; color: #475569; }

        .modal-details { display: flex; flex-direction: column; gap: 12px; }
        .modal-detail-row { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #94a3b8; }
        .modal-detail-row b { color: #f1f5f9; font-weight: 700; text-transform: uppercase; font-size: 11px; }

        .close-modal { position: absolute; top: 20px; right: 20px; color: #64748b; font-size: 18px; cursor: pointer; padding: 5px; }
    </style>
</head>
<body>

    <header>
        <img src="inter-milan-old.png" alt="Logo">
        <h1>Admin Center</h1>
        <i class="fa fa-power-off logout-btn" id="logoutBtn"></i>
    </header>

    <nav>
        <a class="active" onclick="navigateAdmin('dashboard')"><i class="fa fa-house"></i> Home</a>
        <a onclick="navigateAdmin('squad')"><i class="fa fa-users"></i> Squad</a>
        <a onclick="navigateAdmin('matches')"><i class="fa fa-futbol"></i> Matches</a>
        <a onclick="navigateAdmin('records')"><i class="fa fa-medal"></i> Records</a>
    </nav>

    <!-- ========== DASHBOARD PAGE ========== -->
    <div id="dashboardPage" class="page-section active">
        <div class="container">
            <div class="dashboard-header">
                <div class="welcome-box"><h2>Overview</h2><p id="seasonLabel">All-Time Stats</p></div>
                <select id="dashboardFilter"><option value="all">All Seasons</option></select>
            </div>

            <div class="stats-grid">
                <div class="stat-card full-card">
                    <h3>Win Rate</h3><span class="val" id="dashWinRate">0%</span>
                    <div class="form-dots" id="dashForm"></div>
                </div>
                <div class="stat-card trophy-card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3>Club Honors</h3><span class="val" id="dashTrophies">0</span>
                    </div>
                    <div id="dashTrophyList" class="mini-trophy-list"></div>
                </div>
                <div class="stat-card"><h3>Matches</h3><span class="val" id="dashMatches">0</span><p class="stat-sub" id="dashWDL">0W 0D 0L</p></div>
                <div class="stat-card"><h3>Squad Size</h3><span class="val" id="dashPlayers">0</span><p class="stat-sub">Active Players</p></div>
                <div class="stat-card"><h3>Avg Goals</h3><span class="val" id="dashAvgGoals">0.0</span><p class="stat-sub">Per Match</p></div>
                <div class="stat-card"><h3>Total Goals</h3><span class="val" id="dashTotalGoals">0</span><p class="stat-sub">Scored</p></div>
            </div>

            <div style="background: rgba(30, 41, 59, 0.4); border-radius: 28px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.06);">
                <h4 style="margin:0 0 15px; font-size:11px; color:var(--accent); text-transform:uppercase; letter-spacing:2px; font-weight:800;">
                    <i class="fa fa-history" style="margin-right:5px;"></i> Recent Activity
                </h4>
                <div id="dashRecent"></div>
            </div>
        </div>
    </div>

    <!-- ========== SQUAD PAGE ========== -->
    <div id="squadPage" class="page-section">
        <div class="container">
            <button class="btn-add" id="addPlayerBtn"><i class="fa fa-user-plus" style="margin-right:8px;"></i> Register New Player</button>
            <div id="squadList"><p style="text-align:center; color:#64748b; font-size:12px; font-weight:700;">Loading squad data...</p></div>
        </div>
    </div>

    <!-- ========== MATCHES PAGE ========== -->
    <div id="matchesPage" class="page-section">
        <div class="container">
            <button class="btn-add success" id="addMatchBtn"><i class="fa fa-plus-circle" style="margin-right:8px;"></i> New Match Report</button>
            <div id="matchList"></div>
        </div>
    </div>

    <!-- ========== RECORDS PAGE ========== -->
    <div id="recordsPage" class="page-section">
        <div class="container">
            <select id="recordsFilter" style="width:100%; padding:15px; border-radius:18px; font-size:13px; margin-bottom:25px;">
                <option value="all">All-Time Statistics</option>
            </select>

            <div class="trophy-section">
                <div class="section-label"><span>Club Honors</span><i class="fa fa-trophy" style="color:var(--gold)"></i></div>
                <div id="trophyList"></div>
                <button style="width:100%; padding:12px; border:1px dashed rgba(255,255,255,0.2); background:none; color:#64748b; border-radius:15px; font-size:10px; font-weight:800; cursor:pointer; margin-top:10px; letter-spacing:1px;" onclick="openTrophyModal()">+ ADD NEW HONOR</button>
            </div>

            <div class="awards-grid">
                <div class="award-box motm"><i class="fa fa-medal"></i><b id="bestMOTM">-</b><small>Most MOTM</small></div>
                <div class="award-box mvp"><i class="fa fa-crown"></i><b id="bestMVP">-</b><small>Most MVP</small></div>
            </div>

            <div class="admin-summary">
                <div class="stat-card"><b id="totalGoals">0</b><small>Goals</small></div>
                <div class="stat-card"><b id="totalAssists">0</b><small>Assists</small></div>
                <div class="stat-card"><b id="totalSaves">0</b><small>Saves</small></div>
                <div class="stat-card"><b id="totalCS">0</b><small>CS</small></div>
            </div>

            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchRecordTab('goals', this)">GOALS</button>
                <button class="tab-btn" onclick="switchRecordTab('assists', this)">ASSISTS</button>
                <button class="tab-btn" onclick="switchRecordTab('saves', this)">SAVES</button>
            </div>

            <div id="goalsTab" class="record-container active"></div>
            <div id="assistsTab" class="record-container"></div>
            <div id="savesTab" class="record-container"></div>
        </div>
    </div>

    <!-- ========== MODALS ========== -->
    
    <!-- Dashboard Match Detail Modal -->
    <div id="dashMatchModal" class="modal">
        <div class="modal-content">
            <i class="fa fa-times close-modal" onclick="closeModal('dashMatchModal')"></i>
            <div class="modal-title">
                <h4 id="dmSeason">Season</h4>
                <h2 id="dmOpponent">Opponent</h2>
            </div>
            <div class="modal-score-big">
                <span id="dmHome">0</span>
                <small>VS</small>
                <span id="dmAway">0</span>
            </div>
            <div class="modal-details">
                <div class="modal-detail-row"><span>Competition</span><b id="dmLeague">--</b></div>
                <div class="modal-detail-row"><span>Result</span><b id="dmResult">--</b></div>
                <div class="modal-detail-row"><span>Log Date</span><b id="dmDate">--</b></div>
            </div>
        </div>
    </div>

    <!-- Player Modal -->
    <div id="playerModal" class="modal">
        <div class="modal-content">
            <div style="font-weight:800; text-align:center; margin-bottom:25px; text-transform: uppercase; color: var(--accent); letter-spacing: 2px; font-size: 14px;" id="playerModalTitle">Register Player</div>
            <form id="playerForm">
                <input type="hidden" id="playerId">
                
                <label>Full Name</label>
                <input type="text" id="playerName" placeholder="Enter player name..." required>
                
                <label>Positions</label>
                <div class="pos-selector" id="posSelector">
                    <div class="pos-opt" data-val="GK">GK</div>
                    <div class="pos-opt" data-val="DF">DF</div>
                    <div class="pos-opt" data-val="MF">MF</div>
                    <div class="pos-opt" data-val="FW">FW</div>
                </div>
                
                <button type="submit" class="btn-add">Save Player Data</button>
                <button type="button" onclick="closeModal('playerModal')" class="btn-cancel">CLOSE / CANCEL</button>
            </form>
        </div>
    </div>

    <!-- Match Modal -->
    <div id="matchModal" class="modal">
        <div class="modal-content">
            <div id="matchModalTitle" style="font-weight:900; font-size:14px; text-align:center; margin-bottom:25px; text-transform:uppercase; color:var(--primary); letter-spacing:2px;">Match Report</div>
            <form id="matchForm">
                <input type="hidden" id="matchId">
                
                <div style="display:flex; gap:10px;">
                    <div style="flex:2;"><label>League</label><input type="text" id="matchLeague" placeholder="e.g. Friendly" required></div>
                    <div style="flex:1;"><label>Season</label><input type="text" id="matchSeason" placeholder="S1" required></div>
                </div>

                <label>Scoreline (Home - Away)</label>
                <div class="score-input-group">
                    <input type="number" id="matchHome" placeholder="0" min="0" required>
                    <div style="text-align:center;font-weight:900;opacity:0.2;font-size:12px;">-</div>
                    <input type="number" id="matchAway" placeholder="0" min="0" required>
                </div>

                <label>Opponent Name</label>
                <input type="text" id="matchOpponent" placeholder="Team Name" required>

                <label style="margin-top:15px;">Select Squad Involved</label>
                <div id="playerPicker"></div>

                <div id="statsArea"></div>
                
                <button type="submit" class="btn-add success">Save Match Report</button>
                <button type="button" onclick="closeModal('matchModal')" class="btn-cancel">CLOSE / CANCEL</button>
            </form>
        </div>
    </div>

    <!-- Trophy Modal -->
    <div id="trophyModal" class="modal">
        <div class="modal-content">
            <h3 style="text-align:center; margin-top:0; color:var(--primary); text-transform:uppercase; letter-spacing:2px;">Add Honor</h3>
            <input type="text" id="trophyName" placeholder="Competition Name">
            <input type="text" id="trophySeason" placeholder="Season (e.g. S1)">
            <select id="trophyRank">
                <option value="gold">ü•á Winner / 1st Place</option>
                <option value="silver">ü•à Runner-up / 2nd Place</option>
                <option value="bronze">ü•â 3rd Place</option>
            </select>
            <button style="width:100%; padding:15px; background:var(--primary); color:#fff; border:none; border-radius:15px; font-weight:800; margin-top:10px;" onclick="saveTrophy()">SAVE HONOR</button>
            <button style="width:100%; background:none; border:none; color:#64748b; margin-top:15px; cursor:pointer; font-weight:700; font-size:11px;" onclick="closeModal('trophyModal')">CANCEL</button>
        </div>
    </div>

    <!-- Player Stats Modal (for Records) -->
    <div id="playerStatsModal" class="modal">
        <div class="modal-content">
            <i class="fa fa-times close-modal" onclick="closeModal('playerStatsModal')"></i>
            <h3 id="psName" style="text-align:center; margin:0; color:#fff; font-size:20px;">Player Name</h3>
            <div id="psGrid" class="p-stat-grid"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc, updateDoc, getDoc, setDoc, limit, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAuUcXmYjMU-XaL_w7h4y43RHku4dQGFlk",
            authDomain: "inter-manila.firebaseapp.com",
            projectId: "inter-manila",
            storageBucket: "inter-manila.firebasestorage.app",
            messagingSenderId: "285507279342",
            appId: "1:285507279342:web:5aa0c80a08fb92727416ff"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global data
        let allMatches = [];
        let allPlayers = [];
        let playerData = {};
        let globalPlayerStats = {};
        
        // Match form data
        let selectedPlayers = [];
        let motmId = "";
        let mvpId = "";
        
        // Squad form data
        let selectedPositions = [];

        // Auth check
        onAuthStateChanged(auth, (user) => {
            if (user) { 
                document.body.style.display = "block"; 
                initializeApp();
            } else { 
                window.location.replace("login.html"); 
            }
        });

        function initializeApp() {
            loadTrophies();
            loadPlayers();
            loadMatches();
        }

        // ========== NAVIGATION ==========
        window.navigateAdmin = (page) => {
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('nav a').forEach(n => n.classList.remove('active'));
            
            const pageMap = {
                'dashboard': 'dashboardPage',
                'squad': 'squadPage',
                'matches': 'matchesPage',
                'records': 'recordsPage'
            };
            
            document.getElementById(pageMap[page]).classList.add('active');
            document.querySelectorAll('nav a')[['dashboard', 'squad', 'matches', 'records'].indexOf(page)].classList.add('active');
            
            if (page === 'dashboard') renderDashboard();
            if (page === 'matches') renderMatches();
            if (page === 'records') renderRecords();
        };

        // Logout
        document.getElementById('logoutBtn').onclick = () => {
            if (confirm("Keluar dari panel admin?")) {
                signOut(auth).then(() => window.location.replace("login.html"));
            }
        };

        // ========== DATA LOADING ==========
        function loadTrophies() {
            onSnapshot(query(collection(db, "trophies"), orderBy("timestamp", "desc")), (snapshot) => {
                // Dashboard
                document.getElementById('dashTrophies').innerText = snapshot.size;
                const miniList = document.getElementById('dashTrophyList');
                miniList.innerHTML = "";
                snapshot.docs.slice(0, 3).forEach(doc => {
                    const t = doc.data();
                    const color = t.rank === 'gold' ? 'var(--gold)' : (t.rank === 'silver' ? 'var(--silver)' : 'var(--bronze)');
                    miniList.innerHTML += `<div class="mini-t-item"><i class="fa fa-trophy" style="color:${color}"></i>${t.name}<span>${t.season}</span></div>`;
                });

                // Records
                const fullList = document.getElementById('trophyList');
                fullList.innerHTML = "";
                snapshot.forEach(doc => {
                    const t = doc.data();
                    const r = t.rank || 'gold';
                    const icon = r === 'gold' ? 'fa-trophy t-gold' : (r === 'silver' ? 'fa-medal t-silver' : 'fa-award t-bronze');
                    fullList.innerHTML += `
                        <div class="t-row">
                            <i class="fa ${icon}" style="font-size:16px"></i>
                            <div style="flex:1">
                                <div style="font-size:13px; font-weight:700; color:#fff">${t.name}</div>
                                <div style="font-size:10px; color:#64748b">${t.season}</div>
                            </div>
                            <i class="fa fa-trash" style="color:var(--danger); cursor:pointer; opacity:0.5; font-size:12px" onclick="deleteTrophy('${doc.id}')"></i>
                        </div>`;
                });
            });
        }

        function loadPlayers() {
            onSnapshot(collection(db, "players"), (snapshot) => {
                allPlayers = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                allPlayers.forEach(p => playerData[p.id] = p);

                // Dashboard count
                let activeCount = 0;
                allPlayers.forEach(p => { if (p.active !== false) activeCount++; });
                document.getElementById('dashPlayers').innerText = activeCount;

                // Squad page
                renderSquad();
                renderRecords();
            });
        }

        function loadMatches() {
            onSnapshot(query(collection(db, "matches"), orderBy("timestamp", "desc")), (snapshot) => {
                allMatches = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                updateAllFilters();
                renderDashboard();
                renderMatches();
                renderRecords();
            });
        }

        function updateAllFilters() {
            const seasons = [...new Set(allMatches.map(m => `${m.league||''} ${m.season||''}`.trim()))].filter(Boolean).sort();
            
            // Dashboard filter
            const dashFilter = document.getElementById('dashboardFilter');
            const dashCurrent = dashFilter.value;
            dashFilter.innerHTML = '<option value="all">All Seasons</option>';
            seasons.forEach(s => { dashFilter.innerHTML += `<option value="${s}">${s}</option>`; });
            dashFilter.value = dashCurrent;
            
            // Records filter
            const recFilter = document.getElementById('recordsFilter');
            const recCurrent = recFilter.value;
            recFilter.innerHTML = '<option value="all">All-Time Statistics</option>';
            seasons.forEach(s => { recFilter.innerHTML += `<option value="${s}">${s}</option>`; });
            recFilter.value = recCurrent;
        }

        // ========== DASHBOARD ==========
        function renderDashboard() {
            const filterValue = document.getElementById('dashboardFilter').value;
            const filtered = filterValue === 'all' ? allMatches : allMatches.filter(m => `${m.league||''} ${m.season||''}`.trim() === filterValue);
            
            let wins = 0, draws = 0, losses = 0, totalGoals = 0;
            let recentHTML = "";
            let formDots = [];

            filtered.forEach((m, i) => {
                const hs = parseInt(m.homeScore) || 0;
                const as = parseInt(m.awayScore) || 0;
                totalGoals += hs;
                
                let result = hs > as ? 'W' : (hs < as ? 'L' : 'D');
                if (result === 'W') wins++;
                else if (result === 'L') losses++;
                else draws++;
                
                if (formDots.length < 5) formDots.push(`<span class="dot dot-${result}"></span>`);

                if (i < 5) {
                    recentHTML += `<div class="activity-item" onclick="openDashMatchDetail('${m.id}')">
                        <div class="team-info"><b>vs ${m.opponent}</b><small>${m.league} ‚Ä¢ ${m.season}</small></div>
                        <div class="score-pill" style="color:${result==='W'?'var(--success)':result==='L'?'var(--danger)':'#64748b'}">${hs} - ${as}</div>
                    </div>`;
                }
            });

            document.getElementById('dashWinRate').innerText = filtered.length ? Math.round((wins / filtered.length) * 100) + "%" : "0%";
            document.getElementById('dashMatches').innerText = filtered.length;
            document.getElementById('dashWDL').innerText = `${wins}W ${draws}D ${losses}L`;
            document.getElementById('dashAvgGoals').innerText = filtered.length ? (totalGoals / filtered.length).toFixed(1) : "0.0";
            document.getElementById('dashTotalGoals').innerText = totalGoals;
            document.getElementById('dashForm').innerHTML = formDots.join('') || '';
            document.getElementById('dashRecent').innerHTML = recentHTML || '<p style="text-align:center;font-size:11px;color:#64748b;">No matches recorded.</p>';
            document.getElementById('seasonLabel').innerText = filterValue === 'all' ? "All-Time Stats" : filterValue;
        }

        window.openDashMatchDetail = (id) => {
            const match = allMatches.find(m => m.id === id);
            if (!match) return;
            
            document.getElementById('dmOpponent').innerText = match.opponent;
            document.getElementById('dmSeason').innerText = match.season;
            document.getElementById('dmHome').innerText = match.homeScore;
            document.getElementById('dmAway').innerText = match.awayScore;
            document.getElementById('dmLeague').innerText = match.league;
            
            let result = "Draw";
            if (parseInt(match.homeScore) > parseInt(match.awayScore)) result = "Win";
            else if (parseInt(match.homeScore) < parseInt(match.awayScore)) result = "Loss";
            document.getElementById('dmResult').innerText = result;
            
            document.getElementById('dmDate').innerText = match.timestamp ? new Date(match.timestamp.seconds * 1000).toLocaleDateString('id-ID') : '-';
            document.getElementById('dashMatchModal').classList.add('active');
        };

        document.getElementById('dashboardFilter').onchange = renderDashboard;

        // ========== SQUAD ==========
        function renderSquad() {
            const list = document.getElementById('squadList');
            list.innerHTML = "";
            
            if (allPlayers.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#64748b;font-size:12px;">No players registered.</p>';
                return;
            }

            const sorted = [...allPlayers].sort((a, b) => a.name.localeCompare(b.name));
            sorted.forEach(p => {
                const active = p.active !== false;
                const positions = Array.isArray(p.pos) ? p.pos : [p.pos];
                list.innerHTML += `
                    <div class="player-card ${active ? '' : 'inactive'}">
                        <div>
                            <span class="p-name">${p.name}</span>
                            <span class="p-status">${active ? 'Active Member' : 'Ex-Player'}</span>
                            <div style="margin-top:2px;">${positions.map(pos => `<span class="pos-badge">${pos}</span>`).join('')}</div>
                        </div>
                        <div class="player-actions">
                            <i class="fa fa-toggle-${active?'on':'off'}" onclick="togglePlayerStatus('${p.id}', ${active})"></i>
                            <i class="fa fa-edit" onclick="editPlayer('${p.id}')"></i>
                            <i class="fa fa-trash" onclick="deletePlayer('${p.id}')"></i>
                        </div>
                    </div>`;
            });
        }

        document.getElementById('addPlayerBtn').onclick = () => {
            document.getElementById('playerModalTitle').innerText = "Register Player";
            document.getElementById('playerId').value = "";
            document.getElementById('playerName').value = "";
            selectedPositions = [];
            document.querySelectorAll('.pos-opt').forEach(o => o.classList.remove('selected'));
            document.getElementById('playerModal').classList.add('active');
        };

        // Position selector
        document.querySelectorAll('.pos-opt').forEach(o => {
            o.onclick = () => {
                const val = o.dataset.val;
                if (selectedPositions.includes(val)) {
                    selectedPositions = selectedPositions.filter(x => x !== val);
                    o.classList.remove('selected');
                } else {
                    selectedPositions.push(val);
                    o.classList.add('selected');
                }
            };
        });

        document.getElementById('playerForm').onsubmit = async (e) => {
            e.preventDefault();
            const id = document.getElementById('playerId').value;
            const name = document.getElementById('playerName').value;
            
            if (selectedPositions.length === 0) {
                alert("Please select at least one position!");
                return;
            }
            
            const data = { name: name, pos: selectedPositions };
            
            try {
                if (id) {
                    await updateDoc(doc(db, "players", id), data);
                } else {
                    await addDoc(collection(db, "players"), { 
                        ...data, 
                        goals: 0, assists: 0, saves: 0, motm: 0, mvp: 0, active: true 
                    });
                }
                closeModal('playerModal');
            } catch (ex) {
                alert("Error: " + ex.message);
            }
        };

        window.togglePlayerStatus = async (id, isActive) => {
            await updateDoc(doc(db, "players", id), { active: !isActive });
        };

        window.editPlayer = (id) => {
            const p = playerData[id];
            document.getElementById('playerId').value = id;
            document.getElementById('playerName').value = p.name;
            selectedPositions = Array.isArray(p.pos) ? [...p.pos] : [p.pos];
            document.querySelectorAll('.pos-opt').forEach(o => {
                o.classList.toggle('selected', selectedPositions.includes(o.dataset.val));
            });
            document.getElementById('playerModalTitle').innerText = "Edit Player Data";
            document.getElementById('playerModal').classList.add('active');
        };

        window.deletePlayer = async (id) => {
            if (confirm("Hapus pemain ini secara permanen?")) {
                await deleteDoc(doc(db, "players", id));
            }
        };

        // ========== MATCHES ==========
        function renderMatches() {
            const list = document.getElementById('matchList');
            list.innerHTML = "";
            
            if (allMatches.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#64748b;font-size:12px;padding:40px;">No matches recorded yet.</p>';
                return;
            }

            allMatches.forEach(m => {
                list.innerHTML += `
                    <div class="match-card">
                        <div class="match-actions">
                            <i class="fa fa-edit" onclick="editMatch('${m.id}')"></i>
                            <i class="fa fa-trash" onclick="deleteMatch('${m.id}')"></i>
                        </div>
                        <div class="league-badge">${m.league} ‚Ä¢ ${m.season}</div>
                        <div class="score-row">
                            <div class="team-name">INTER</div>
                            <div class="score-center"><div class="agg-score">${m.homeScore}-${m.awayScore}</div></div>
                            <div class="team-name" style="text-align:right;">${m.opponent}</div>
                        </div>
                        <div class="stats-box">
                            ${m.scorers?.filter(s => s.goals > 0 || s.assists > 0 || s.saves > 0).map(s => `
                                <div class="stat-item">
                                    <span class="stat-player">${s.name} <small>${s.pos || 'PL'}</small>
                                    ${s.id === m.motmId ? 'üèÖ' : ''} ${s.id === m.mvpId ? 'üëë' : ''}</span>
                                    <span class="stat-vals">G:<b>${s.goals}</b> A:<b>${s.assists}</b> S:<b>${s.saves}</b></span>
                                </div>`).join('') || '<p style="text-align:center;font-size:10px;color:#64748b;margin:5px 0;">No individual stats</p>'}
                        </div>
                    </div>`;
            });
        }

        document.getElementById('addMatchBtn').onclick = () => {
            document.getElementById('matchModalTitle').innerText = "Match Report";
            document.getElementById('matchId').value = "";
            document.getElementById('matchForm').reset();
            selectedPlayers = [];
            motmId = "";
            mvpId = "";
            renderPlayerPicker();
            renderStatsArea();
            document.getElementById('matchModal').classList.add('active');
        };

        function renderPlayerPicker() {
            const activePlayers = allPlayers.filter(p => p.active !== false);
            const picker = document.getElementById('playerPicker');
            picker.innerHTML = activePlayers.map(p => `
                <div class="p-chip ${selectedPlayers.some(x => x.id === p.id) ? 'selected' : ''}" onclick="togglePlayer('${p.id}')">
                    <b>${p.pos || 'PL'}</b> ${p.name}
                </div>
            `).join('');
        }

        window.togglePlayer = (id) => {
            const index = selectedPlayers.findIndex(x => x.id === id);
            if (index > -1) {
                selectedPlayers.splice(index, 1);
            } else {
                const p = allPlayers.find(x => x.id === id);
                selectedPlayers.push({
                    id: p.id,
                    name: p.name,
                    pos: Array.isArray(p.pos) ? p.pos[0] : p.pos,
                    goals: 0,
                    assists: 0,
                    saves: 0
                });
            }
            renderPlayerPicker();
            renderStatsArea();
        };

        function renderStatsArea() {
            const area = document.getElementById('statsArea');
            if (selectedPlayers.length === 0) {
                area.innerHTML = '<div style="text-align:center;color:#64748b;font-size:11px;padding:20px;">Pick players to add stats</div>';
                return;
            }

            let html = `<label style="margin-top:20px;">Individual Stats (G / A / S)</label>`;
            selectedPlayers.forEach(p => {
                html += `
                    <div class="stat-input-row">
                        <span>${p.name}</span>
                        <input type="number" onchange="updatePlayerStat('${p.id}','goals',this.value)" placeholder="0" value="${p.goals}">
                        <input type="number" onchange="updatePlayerStat('${p.id}','assists',this.value)" placeholder="0" value="${p.assists}">
                        <input type="number" onchange="updatePlayerStat('${p.id}','saves',this.value)" placeholder="0" value="${p.saves}">
                    </div>`;
            });

            html += `<div style="margin-top:20px;display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                <div><label>üèÖ MOTM</label><select id="motmSelect" onchange="motmId=this.value">
                    <option value="">None</option>${selectedPlayers.map(p => `<option value="${p.id}" ${motmId === p.id ? 'selected' : ''}>${p.name}</option>`).join('')}
                </select></div>
                <div><label>üëë MVP</label><select id="mvpSelect" onchange="mvpId=this.value">
                    <option value="">None</option>${selectedPlayers.map(p => `<option value="${p.id}" ${mvpId === p.id ? 'selected' : ''}>${p.name}</option>`).join('')}
                </select></div>
            </div>`;

            area.innerHTML = html;
        }

        window.updatePlayerStat = (id, key, value) => {
            const p = selectedPlayers.find(x => x.id === id);
            if (p) p[key] = parseInt(value) || 0;
        };

        window.editMatch = async (id) => {
            const matchDoc = await getDoc(doc(db, "matches", id));
            if (!matchDoc.exists()) return;
            
            const m = matchDoc.data();
            document.getElementById('matchModalTitle').innerText = "Edit Report";
            document.getElementById('matchId').value = id;
            document.getElementById('matchLeague').value = m.league;
            document.getElementById('matchSeason').value = m.season;
            document.getElementById('matchOpponent').value = m.opponent;
            document.getElementById('matchHome').value = m.homeScore;
            document.getElementById('matchAway').value = m.awayScore;
            selectedPlayers = [...m.scorers];
            motmId = m.motmId || "";
            mvpId = m.mvpId || "";
            
            renderPlayerPicker();
            renderStatsArea();
            document.getElementById('matchModal').classList.add('active');
        };

        window.deleteMatch = async (id) => {
            if (!confirm("Delete this match report? This will revert player stats.")) return;
            
            const matchDoc = await getDoc(doc(db, "matches", id));
            if (matchDoc.exists()) {
                const m = matchDoc.data();
                for (let p of m.scorers) {
                    await updateDoc(doc(db, "players", p.id), {
                        goals: increment(-p.goals),
                        assists: increment(-p.assists),
                        saves: increment(-p.saves)
                    });
                }
                if (m.motmId) await updateDoc(doc(db, "players", m.motmId), { motm: increment(-1) });
                if (m.mvpId) await updateDoc(doc(db, "players", m.mvpId), { mvp: increment(-1) });
                await deleteDoc(doc(db, "matches", id));
            }
        };

        document.getElementById('matchForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const matchId = document.getElementById('matchId').value;
            const homeScore = parseInt(document.getElementById('matchHome').value) || 0;
            const totalPlayerGoals = selectedPlayers.reduce((sum, p) => sum + p.goals, 0);
            
            if (totalPlayerGoals > homeScore) {
                alert("Player goals exceed total score!");
                return;
            }

            // Revert old stats if editing
            if (matchId) {
                const oldDoc = await getDoc(doc(db, "matches", matchId));
                if (oldDoc.exists()) {
                    const old = oldDoc.data();
                    for (let s of old.scorers) {
                        await updateDoc(doc(db, "players", s.id), {
                            goals: increment(-s.goals),
                            assists: increment(-s.assists),
                            saves: increment(-s.saves)
                        });
                    }
                    if (old.motmId) await updateDoc(doc(db, "players", old.motmId), { motm: increment(-1) });
                    if (old.mvpId) await updateDoc(doc(db, "players", old.mvpId), { mvp: increment(-1) });
                }
            }

            // Apply new stats
            for (let p of selectedPlayers) {
                await updateDoc(doc(db, "players", p.id), {
                    goals: increment(p.goals),
                    assists: increment(p.assists),
                    saves: increment(p.saves)
                });
            }
            if (motmId) await updateDoc(doc(db, "players", motmId), { motm: increment(1) });
            if (mvpId) await updateDoc(doc(db, "players", mvpId), { mvp: increment(1) });

            const matchData = {
                league: document.getElementById('matchLeague').value,
                season: document.getElementById('matchSeason').value,
                opponent: document.getElementById('matchOpponent').value,
                homeScore: homeScore,
                awayScore: parseInt(document.getElementById('matchAway').value),
                scorers: selectedPlayers,
                motmId: motmId,
                mvpId: mvpId,
                timestamp: serverTimestamp()
            };

            if (matchId) {
                await updateDoc(doc(db, "matches", matchId), matchData);
            } else {
                await addDoc(collection(db, "matches"), matchData);
            }

            closeModal('matchModal');
        };

        // ========== RECORDS ==========
        function renderRecords() {
            const filterValue = document.getElementById('recordsFilter').value;
            const filtered = filterValue === 'all' ? allMatches : allMatches.filter(m => `${m.league||''} ${m.season||''}`.trim() === filterValue);
            
            let totalGoals = 0, totalAssists = 0, totalSaves = 0, cleanSheets = 0;
            globalPlayerStats = {};
            
            allPlayers.forEach(p => {
                globalPlayerStats[p.id] = { ...p, goals: 0, assists: 0, saves: 0, apps: 0, motm: 0, mvp: 0 };
            });

            filtered.forEach(m => {
                totalGoals += (parseInt(m.homeScore) || 0);
                if (parseInt(m.awayScore) === 0) cleanSheets++;
                
                if (m.motmId && globalPlayerStats[m.motmId]) globalPlayerStats[m.motmId].motm++;
                if (m.mvpId && globalPlayerStats[m.mvpId]) globalPlayerStats[m.mvpId].mvp++;
                
                const playedInMatch = new Set();
                if (m.scorers) {
                    m.scorers.forEach(s => {
                        if (globalPlayerStats[s.id]) {
                            globalPlayerStats[s.id].goals += (s.goals || 0);
                            globalPlayerStats[s.id].assists += (s.assists || 0);
                            globalPlayerStats[s.id].saves += (s.saves || 0);
                            totalAssists += (s.assists || 0);
                            totalSaves += (s.saves || 0);
                            playedInMatch.add(s.id);
                        }
                    });
                }
                playedInMatch.forEach(id => globalPlayerStats[id].apps++);
            });

            document.getElementById('totalGoals').innerText = totalGoals;
            document.getElementById('totalAssists').innerText = totalAssists;
            document.getElementById('totalSaves').innerText = totalSaves;
            document.getElementById('totalCS').innerText = cleanSheets;

            const allPlayersList = Object.values(globalPlayerStats);
            const bestMOTM = [...allPlayersList].sort((a, b) => b.motm - a.motm)[0];
            const bestMVP = [...allPlayersList].sort((a, b) => b.mvp - a.mvp)[0];

            document.getElementById('bestMOTM').innerText = (bestMOTM && bestMOTM.motm > 0) ? bestMOTM.name : "-";
            document.getElementById('bestMVP').innerText = (bestMVP && bestMVP.mvp > 0) ? bestMVP.name : "-";

            renderLeaderboard('goalsTab', allPlayersList, 'goals');
            renderLeaderboard('assistsTab', allPlayersList, 'assists');
            renderLeaderboard('savesTab', allPlayersList, 'saves');
        }

        function renderLeaderboard(containerId, data, field) {
            const container = document.getElementById(containerId);
            const sorted = data.filter(p => p[field] > 0).sort((a, b) => b[field] - a[field]);
            const maxVal = sorted.length ? sorted[0][field] : 1;

            container.innerHTML = sorted.map((p, i) => `
                <div class="player-row" onclick="showPlayerStats('${p.id}')">
                    <div class="progress-bar" style="width:${(p[field] / maxVal) * 100}%"></div>
                    <div style="flex:1; z-index:1; display:flex; align-items:center; gap:10px;">
                        <span style="font-size:10px; font-weight:900; color:rgba(255,255,255,0.2)">#${i + 1}</span>
                        <b style="font-size:13px">${p.name}</b>
                    </div>
                    <b style="z-index:1; color:var(--accent); font-size:16px">${p[field]}</b>
                </div>`).join('');

            if (!sorted.length) {
                container.innerHTML = '<div style="text-align:center; padding:30px; color:#64748b; font-size:11px;">No records in this category</div>';
            }
        }

        window.switchRecordTab = (id, btn) => {
            document.querySelectorAll('.record-container').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id + 'Tab').classList.add('active');
            btn.classList.add('active');
        };

        window.showPlayerStats = (id) => {
            const p = globalPlayerStats[id];
            document.getElementById('psName').innerText = p.name;
            document.getElementById('psGrid').innerHTML = `
                <div class="p-stat-item"><b>${p.apps}</b><small>Apps</small></div>
                <div class="p-stat-item"><b>${p.goals}</b><small>Goals</small></div>
                <div class="p-stat-item"><b>${p.assists}</b><small>Assists</small></div>
                <div class="p-stat-item"><b>${p.saves}</b><small>Saves</small></div>
                <div class="p-stat-item" style="border-color:var(--success)"><b style="color:var(--success)">${p.motm}</b><small>MOTM</small></div>
                <div class="p-stat-item" style="border-color:var(--gold)"><b style="color:var(--gold)">${p.mvp}</b><small>MVP</small></div>`;
            document.getElementById('playerStatsModal').classList.add('active');
        };

        document.getElementById('recordsFilter').onchange = renderRecords;

        // Trophy management
        window.openTrophyModal = () => {
            document.getElementById('trophyName').value = "";
            document.getElementById('trophySeason').value = "";
            document.getElementById('trophyModal').classList.add('active');
        };

        window.saveTrophy = async () => {
            const name = document.getElementById('trophyName').value;
            const season = document.getElementById('trophySeason').value;
            
            if (!name || !season) {
                alert("Fill all fields");
                return;
            }

            const id = Date.now().toString();
            await setDoc(doc(db, "trophies", id), {
                name: name,
                season: season,
                rank: document.getElementById('trophyRank').value,
                timestamp: id
            });

            closeModal('trophyModal');
        };

        window.deleteTrophy = async (id) => {
            if (confirm("Permanently delete this honor?")) {
                await deleteDoc(doc(db, "trophies", id));
            }
        };

        // ========== MODAL MANAGEMENT ==========
        window.closeModal = (id) => {
            document.getElementById(id).classList.remove('active');
            setTimeout(() => {
                document.getElementById(id).style.display = 'none';
            }, 300);
            setTimeout(() => {
                document.getElementById(id).style.display = '';
            }, 350);
        };

        // Close modals when clicking outside
        window.onclick = (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        };
    </script>
</body>
</html>
