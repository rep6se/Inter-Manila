<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inter Manila ‚Äî Match Center (Admin)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <style>
        :root {
            --primary: #2563eb; --primary-glow: rgba(37, 99, 235, 0.4); --dark: #020617;
            --surface: #1e293b; --accent: #60a5fa; --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
        }

        body { 
            display: none; margin: 0; font-family: 'Segoe UI', sans-serif; 
            background: radial-gradient(circle at top, #0f172a, #020617); 
            color: #f1f5f9; min-height: 100vh; padding-bottom: 80px;
        }

        header { text-align: center; padding: 40px 0 20px; background: rgba(15, 23, 42, 0.9); border-bottom: 1px solid rgba(255,255,255,0.05); }
        header img { width: 55px; margin-bottom: 10px; filter: drop-shadow(0 0 15px var(--primary-glow)); }
        header h1 { margin: 0; font-size: 20px; color: var(--primary); text-transform: uppercase; letter-spacing: 3px; font-weight: 800; }

        nav { display: flex; justify-content: center; padding: 15px; gap: 10px; background: rgba(15, 23, 42, 0.95); position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        nav a { text-decoration: none; background: rgba(30, 41, 59, 0.5); color: #64748b; padding: 12px 18px; border-radius: 16px; font-size: 11px; font-weight: 700; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
        nav a.active { background: var(--primary); color: white; box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3); }

        .container { max-width: 500px; margin: 20px auto; padding: 0 15px; }

        .btn-add { 
            width: 100%; padding: 18px; background: linear-gradient(135deg, var(--success), #059669); 
            color: white; border: none; border-radius: 22px; font-weight: 800; font-size: 13px;
            cursor: pointer; margin-bottom: 25px; letter-spacing: 1px; text-transform: uppercase;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.25); transition: 0.3s;
        }

        .match-card { background: rgba(30, 41, 59, 0.4); border-radius: 30px; padding: 25px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.08); position: relative; backdrop-filter: blur(10px); }
        .match-actions { position: absolute; top: 20px; right: 20px; display: flex; gap: 15px; z-index: 10; }
        .match-actions i { cursor: pointer; font-size: 15px; transition: 0.2s; padding: 5px; opacity: 0.6; }
        .match-actions .fa-edit { color: var(--accent); }
        .match-actions .fa-trash { color: var(--danger); }

        .league-badge { display: inline-block; background: rgba(37, 99, 235, 0.15); color: var(--accent); font-size: 9px; font-weight: 800; padding: 5px 14px; border-radius: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; }
        .score-row { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .team-name { flex: 1; font-weight: 800; font-size: 14px; color: #fff; text-transform: uppercase; }
        .score-center { flex: 1.5; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .agg-score { font-size: 48px; font-weight: 900; color: #fff; letter-spacing: -1px; line-height: 1; white-space: nowrap; display: inline-block; }

        .stats-box { background: rgba(15, 23, 42, 0.5); border-radius: 20px; padding: 15px; margin-top: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .stat-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.03); align-items: center; }
        .stat-item:last-child { border-bottom: none; }
        .stat-player { font-size: 12px; font-weight: 600; color: #cbd5e1; display: flex; align-items: center; gap: 6px; }
        .stat-player small { font-size: 9px; color: var(--accent); font-weight: 800; opacity: 0.8; }
        .stat-vals { font-size: 11px; font-weight: 800; color: var(--accent); }

        .modal { display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(15px); }
        .modal-content { background: #1e293b; width: 90%; max-width: 450px; margin: 30px auto; border-radius: 35px; border: 1px solid rgba(255,255,255,0.1); padding: 30px 20px; max-height: 85vh; overflow-y: auto; }

        input, select { width: 100%; padding: 15px; margin-bottom: 12px; background: #0f172a; border: 1px solid rgba(255,255,255,0.1); color: #fff; border-radius: 15px; box-sizing: border-box; outline: none; }
        label { font-size: 10px; font-weight: 800; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 5px; padding-left: 5px;}
        .score-input-group { display: grid; grid-template-columns: 1fr 40px 1fr; gap: 10px; align-items: center; margin-bottom: 20px; }
        .score-input-group input { text-align: center; font-size: 24px; font-weight: 900; margin: 0; }

        .p-chip { display: block; padding: 12px 15px; background: rgba(255,255,255,0.05); border-radius: 14px; margin-bottom: 8px; font-size: 12px; cursor: pointer; border: 1px solid transparent; }
        .p-chip.selected { background: rgba(37, 99, 235, 0.2); border-color: var(--primary); }

        .stat-input-row { display: grid; grid-template-columns: 1.5fr 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px; align-items: center; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 15px; }
        .stat-input-row span { font-size: 11px; font-weight: 700; color: #fff; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .stat-input-row input { padding: 8px; margin: 0; text-align: center; font-size: 12px; border: none; }
    </style>
</head>
<body>

    <header><img src="inter-milan-old.png" alt="Logo"><h1>Match Center</h1></header>

    <nav>
        <a href="admin-dashboard.html"><i class="fa fa-home"></i> Home</a>
        <a href="admin-squad.html"><i class="fa fa-users"></i> Squad</a>
        <a href="admin-matches.html" class="active"><i class="fa fa-futbol"></i> Matches</a>
        <a href="admin-records.html"><i class="fa fa-medal"></i> Records</a>
    </nav>

    <div class="container">
        <button class="btn-add" id="_0xnM"><i class="fa fa-plus-circle"></i> New Match Report</button>
        <div id="_0xmlL"><div style="text-align:center;color:#64748b;font-size:12px;padding:40px;">Loading...</div></div>
    </div>

    <div id="_0xmod" class="modal">
        <div class="modal-content">
            <div id="_0xmT" style="font-weight:800;text-align:center;margin-bottom:20px;text-transform:uppercase;color:var(--primary);">New Match Report</div>
            <form id="_0xmF">
                <input type="hidden" id="_0xmid">
                <div style="display:flex;gap:10px;">
                    <input type="text" id="_0xlG" placeholder="League" required>
                    <input type="text" id="_0xseA" placeholder="Season" style="width:120px;" required>
                </div>
                <label>Scoreline</label>
                <div class="score-input-group">
                    <input type="number" id="_0xhS" placeholder="0" min="0" required>
                    <div style="text-align:center;font-weight:900;opacity:0.3;">VS</div>
                    <input type="number" id="_0xaS" placeholder="0" min="0" required>
                </div>
                <input type="text" id="_0xopN" placeholder="Opponent" required>
                <div style="font-size:11px;color:var(--accent);font-weight:800;margin:20px 0 10px;text-transform:uppercase;">Select Lineup</div>
                <div id="_0xpkR" style="max-height:200px;overflow-y:auto;margin-bottom:15px;background:rgba(0,0,0,0.2);padding:10px;border-radius:15px;"></div>
                <div id="_0xstA"></div>
                <button type="submit" class="btn-add" style="background:var(--primary);margin-top:20px;">Save Report</button>
                <button type="button" id="_0xclM" style="width:100%;background:none;border:none;color:#64748b;font-weight:800;cursor:pointer;margin-top:10px;">CANCEL</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp as _0xI } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth as _0xG, onAuthStateChanged as _0xC } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore as _0xF, collection as _0xCL, addDoc as _0xAD, onSnapshot as _0xSN, query as _0xQR, orderBy as _0xOB, doc as _0xDC, deleteDoc as _0xDD, updateDoc as _0xUD, getDoc as _0xGD, increment as _0xINC, serverTimestamp as _0xTS } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const _0xcf = {
            apiKey: "\x41\x49\x7a\x61\x53\x79\x41\x75\x71\x55\x63\x58\x59\x6a\x4d\x55\x2d\x58\x61\x4c\x5f\x77\x37\x68\x34\x79\x34\x33\x52\x48\x6b\x75\x34\x64\x51\x47\x46\x6c\x6b",
            authDomain: "\x69\x6e\x74\x65\x72\x2d\x6d\x61\x6e\x69\x6c\x61\x2e\x66\x69\x72\x65\x62\x61\x73\x65\x61\x70\x70\x2e\x63\x6f\x6d",
            projectId: "\x69\x6e\x74\x65\x72\x2d\x6d\x61\x6e\x69\x6c\x61",
            storageBucket: "\x69\x6e\x74\x65\x72\x2d\x6d\x61\x6e\x69\x6c\x61\x2e\x66\x69\x72\x65\x62\x61\x73\x65\x73\x74\x6f\x72\x61\x67\x65\x2e\x61\x70\x70",
            messagingSenderId: "\x32\x38\x35\x35\x30\x37\x32\x37\x39\x33\x34\x32",
            appId: "\x31\x3a\x32\x38\x35\x35\x30\x37\x32\x37\x39\x33\x34\x32\x3a\x77\x65\x62\x3a\x35\x61\x61\x30\x63\x38\x30\x61\x30\x38\x66\x62\x39\x32\x37\x32\x37\x34\x31\x36\x66\x66"
        };

        const _0xA = _0xI(_0xcf);
        const _0xau = _0xG(_0xA);
        const _0xdb = _0xF(_0xA);

        let _0xactP = []; let _0xselP = []; let _0xtMo = ""; let _0xtMv = "";

        _0xC(_0xau, (_0xu) => {
            if (_0xu) { document.body.style.display = "block"; _0xinit(); }
            else { window.location.href = "\x6c\x6f\x67\x69\x6e\x2e\x68\x74\x6d\x6c"; }
        });

        function _0xinit() {
            _0xSN(_0xCL(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73"), (sn) => {
                _0xactP = sn.docs.map(d => ({id: d.id, ...d.data()})).filter(p => p.active !== false);
                _0xrnP();
            });

            _0xSN(_0xQR(_0xCL(_0xdb, "\x6d\x61\x74\x63\x68\x65\x73"), _0xOB("\x74\x69\x6d\x65\x73\x74\x61\x6d\x70", "\x64\x65\x73\x63")), (sn) => {
                const l = document.getElementById('_0xmlL');
                l.innerHTML = sn.empty ? '<div style="text-align:center;color:#64748b;padding:40px;">No matches.</div>' : "";
                sn.forEach(d => {
                    const m = d.data();
                    l.innerHTML += `
                    <div class="match-card">
                        <div class="match-actions">
                            <i class="fa fa-edit" onclick="_0xedM('${d.id}')"></i>
                            <i class="fa fa-trash" onclick="_0xdlM('${d.id}')"></i>
                        </div>
                        <div class="league-badge">${m.league} ‚Ä¢ ${m.season}</div>
                        <div class="score-row">
                            <div class="team-name">INTER</div>
                            <div class="score-center"><div class="agg-score">${m.homeScore}-${m.awayScore}</div></div>
                            <div class="team-name" style="text-align:right;">${m.opponent}</div>
                        </div>
                        <div class="stats-box">
                            ${m.scorers?.filter(s => s.goals > 0 || s.assists > 0 || s.saves > 0).map(s => `
                                <div class="stat-item">
                                    <span class="stat-player">${s.name} <small>${s.pos || ''}</small>
                                    ${s.id === m.motmId ? 'üèÖ' : ''} ${s.id === m.mvpId ? 'üëë' : ''}</span>
                                    <span class="stat-vals">${s.goals}G ${s.assists}A ${s.saves}S</span>
                                </div>`).join('')}
                        </div>
                    </div>`;
                });
            });
        }

        function _0xrnP() {
            const d = document.getElementById('_0xpkR'); if(!d) return;
            d.innerHTML = _0xactP.map(p => `<div class="p-chip ${_0xselP.some(x => x.id === p.id) ? 'selected' : ''}" onclick="_0xtgP('${p.id}')"><b>${p.pos || 'PL'}</b> ${p.name}</div>`).join('');
        }

        window._0xtgP = (id) => {
            const i = _0xselP.findIndex(x => x.id === id);
            if(i > -1) _0xselP.splice(i, 1);
            else { const p = _0xactP.find(x => x.id === id); _0xselP.push({id: p.id, name: p.name, pos: p.pos, goals:0, assists:0, saves:0}); }
            _0xrnP(); _0xrnS();
        };

        function _0xrnS() {
            const a = document.getElementById('_0xstA'); if(!a) return;
            if (_0xselP.length === 0) { a.innerHTML = '<div style="text-align:center;color:#64748b;font-size:11px;padding:20px;">Select players</div>'; return; }
            let h = `<label style="margin-top:20px;">Individual Stats</label>` + _0xselP.map(p => `
                <div class="stat-input-row"><span>${p.name}</span>
                    <input type="number" onchange="_0xuPS('${p.id}','goals',this.value)" placeholder="G" value="${p.goals}">
                    <input type="number" onchange="_0xuPS('${p.id}','assists',this.value)" placeholder="A" value="${p.assists}">
                    <input type="number" onchange="_0xuPS('${p.id}','saves',this.value)" placeholder="S" value="${p.saves}">
                </div>`).join('');
            h += `<div style="margin-top:20px;display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                <div><label>üèÖ MOTM</label><select id="_0xmoS"><option value="">None</option>${_0xselP.map(p => `<option value="${p.id}" ${_0xtMo === p.id ? 'selected' : ''}>${p.name}</option>`).join('')}</select></div>
                <div><label>üëë MVP</label><select id="_0xmvS"><option value="">None</option>${_0xselP.map(p => `<option value="${p.id}" ${_0xtMv === p.id ? 'selected' : ''}>${p.name}</option>`).join('')}</select></div>
            </div>`;
            a.innerHTML = h;
        }

        window._0xuPS = (id, k, v) => { const p = _0xselP.find(x => x.id === id); if(p) p[k] = parseInt(v) || 0; };

        window._0xedM = async (id) => {
            const s = await _0xGD(_0xDC(_0xdb, "\x6d\x61\x74\x63\x68\x65\x73", id));
            if(!s.exists()) return;
            const m = s.data();
            document.getElementById('_0xmT').innerText = "Edit Report";
            document.getElementById('_0xmid').value = id;
            document.getElementById('_0xlG').value = m.league;
            document.getElementById('_0xseA').value = m.season;
            document.getElementById('_0xopN').value = m.opponent;
            document.getElementById('_0xhS').value = m.homeScore;
            document.getElementById('_0xaS').value = m.awayScore;
            _0xselP = [...m.scorers]; _0xtMo = m.motmId || ""; _0xtMv = m.mvpId || "";
            document.getElementById('_0xmod').style.display='block';
            _0xrnP(); _0xrnS();
        };

        window._0xdlM = async (id) => {
            if(!confirm("Hapus pertandingan?")) return;
            const s = await _0xGD(_0xDC(_0xdb, "\x6d\x61\x74\x63\x68\x65\x73", id));
            if(s.exists()){
                const m = s.data();
                for(let p of m.scorers) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", p.id), { goals: _0xINC(-p.goals), assists: _0xINC(-p.assists), saves: _0xINC(-p.saves) });
                if(m.motmId) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", m.motmId), { motm: _0xINC(-1) });
                if(m.mvpId) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", m.mvpId), { mvp: _0xINC(-1) });
                await _0xDD(_0xDC(_0xdb, "\x6d\x61\x74\x63\x68\x65\x73", id));
            }
        };

        document.getElementById('_0xmF').onsubmit = async (e) => {
            e.preventDefault();
            const mid = document.getElementById('_0xmid').value;
            const hs = parseInt(document.getElementById('_0xhS').value) || 0;
            const mo = document.getElementById('_0xmoS').value;
            const mv = document.getElementById('_0xmvS').value;

            if (_0xselP.reduce((s, p) => s + p.goals, 0) !== hs) return alert("Total gol pemain harus match!");

            if(mid) {
                const oDoc = await _0xGD(_0xDC(_0xdb, "\x6d\x61\x74\x63\x68\x65\x73", mid));
                if(oDoc.exists()) {
                    const o = oDoc.data();
                    for(let s of o.scorers) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", s.id), { goals: _0xINC(-s.goals), assists: _0xINC(-s.assists), saves: _0xINC(-s.saves) });
                    if(o.motmId) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", o.motmId), { motm: _0xINC(-1) });
                    if(o.mvpId) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", o.mvpId), { mvp: _0xINC(-1) });
                }
            }

            for(let p of _0xselP) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", p.id), { goals: _0xINC(p.goals), assists: _0xINC(p.assists), saves: _0xINC(p.saves) });
            if(mo) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", mo), { motm: _0xINC(1) });
            if(mv) await _0xUD(_0xDC(_0xdb, "\x70\x6c\x61\x79\x65\x72\x73", mv), { mvp: _0xINC(1) });

            const mD = { league: document.getElementById('_0xlG').value, season: document.getElementById('_0xseA').value, opponent: document.getElementById('_0xopN').value, homeScore: hs, awayScore: parseInt(document.getElementById('_0xaS').value), scorers: _0xselP, motmId: mo, mvpId: mv, timestamp: _0xTS() };
            if (mid) await _0xUD(_0xDC(_0xdb, "\x6d\x61\x74\x63\x68\x65\x73", mid), mD);
            else await _0xAD(_0xCL(_0xdb, "\x6d\x61\x74\x63\x68\x65\x73"), mD);
            _0xcl();
        };

        document.getElementById('_0xnM').onclick = () => { document.getElementById('_0xmod').style.display = 'block'; };
        document.getElementById('_0xclM').onclick = _0xcl;

        function _0xcl() {
            document.getElementById('_0xmod').style.display = 'none'; document.getElementById('_0xmF').reset();
            document.getElementById('_0xmid').value = ""; _0xselP = []; _0xtMo = ""; _0xtMv = ""; _0xrnP(); _0xrnS();
        }
    </script>
</body>
</html>
